/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const e=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,t=Symbol(),s=new WeakMap;class i{constructor(e,s,i){if(this._$cssResult$=!0,i!==t)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=s}get styleSheet(){let t=this.o;const i=this.t;if(e&&void 0===t){const e=void 0!==i&&1===i.length;e&&(t=s.get(i)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),e&&s.set(i,t))}return t}toString(){return this.cssText}}const n=e?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let s="";for(const t of e.cssRules)s+=t.cssText;return(e=>new i("string"==typeof e?e:e+"",void 0,t))(s)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var o;const r=window.trustedTypes,a=r?r.emptyScript:"",c=window.reactiveElementPolyfillSupport,l={toAttribute(e,t){switch(t){case Boolean:e=e?a:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(e){s=null}}return s}},d=(e,t)=>t!==e&&(t==t||e==e),h={attribute:!0,type:String,converter:l,reflect:!1,hasChanged:d};class u extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;null!==(t=this.h)&&void 0!==t||(this.h=[]),this.h.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,s)=>{const i=this._$Ep(s,t);void 0!==i&&(this._$Ev.set(i,s),e.push(i))})),e}static createProperty(e,t=h){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const s="symbol"==typeof e?Symbol():"__"+e,i=this.getPropertyDescriptor(e,s,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,t,s){return{get(){return this[t]},set(i){const n=this[e];this[t]=i,this.requestUpdate(e,n,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||h}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const s of t)this.createProperty(s,e[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(n(e))}else void 0!==e&&t.push(n(e));return t}static _$Ep(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,s;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(s=e.hostConnected)||void 0===s||s.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var t;const s=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,s)=>{e?t.adoptedStyleSheets=s.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):s.forEach((e=>{const s=document.createElement("style"),i=window.litNonce;void 0!==i&&s.setAttribute("nonce",i),s.textContent=e.cssText,t.appendChild(s)}))})(s,this.constructor.elementStyles),s}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$EO(e,t,s=h){var i,n;const o=this.constructor._$Ep(e,s);if(void 0!==o&&!0===s.reflect){const r=(null!==(n=null===(i=s.converter)||void 0===i?void 0:i.toAttribute)&&void 0!==n?n:l.toAttribute)(t,s.type);this._$El=e,null==r?this.removeAttribute(o):this.setAttribute(o,r),this._$El=null}}_$AK(e,t){var s,i;const n=this.constructor,o=n._$Ev.get(e);if(void 0!==o&&this._$El!==o){const e=n.getPropertyOptions(o),r=e.converter,a=null!==(i=null!==(s=null==r?void 0:r.fromAttribute)&&void 0!==s?s:"function"==typeof r?r:null)&&void 0!==i?i:l.fromAttribute;this._$El=o,this[o]=a(t,e.type),this._$El=null}}requestUpdate(e,t,s){let i=!0;void 0!==e&&(((s=s||this.constructor.getPropertyOptions(e)).hasChanged||d)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===s.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,s))):i=!1),!this.isUpdatePending&&i&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const s=this._$AL;try{t=this.shouldUpdate(s),t?(this.willUpdate(s),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(s)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(s)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var p;u.finalized=!0,u.elementProperties=new Map,u.elementStyles=[],u.shadowRootOptions={mode:"open"},null==c||c({ReactiveElement:u}),(null!==(o=globalThis.reactiveElementVersions)&&void 0!==o?o:globalThis.reactiveElementVersions=[]).push("1.3.4");const g=globalThis.trustedTypes,y=g?g.createPolicy("lit-html",{createHTML:e=>e}):void 0,f=`lit$${(Math.random()+"").slice(9)}$`,m="?"+f,v=`<${m}>`,w=document,b=(e="")=>w.createComment(e),k=e=>null===e||"object"!=typeof e&&"function"!=typeof e,E=Array.isArray,A=e=>E(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),S=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,C=/-->/g,D=/>/g,I=RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),_=/'/g,M=/"/g,x=/^(?:script|style|textarea|title)$/i,$=(e=>(t,...s)=>({_$litType$:e,strings:t,values:s}))(1),B=Symbol.for("lit-noChange"),O=Symbol.for("lit-nothing"),T=new WeakMap,P=w.createTreeWalker(w,129,null,!1),U=(e,t)=>{const s=e.length-1,i=[];let n,o=2===t?"<svg>":"",r=S;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(r.lastIndex=d,c=r.exec(s),null!==c);)d=r.lastIndex,r===S?"!--"===c[1]?r=C:void 0!==c[1]?r=D:void 0!==c[2]?(x.test(c[2])&&(n=RegExp("</"+c[2],"g")),r=I):void 0!==c[3]&&(r=I):r===I?">"===c[0]?(r=null!=n?n:S,l=-1):void 0===c[1]?l=-2:(l=r.lastIndex-c[2].length,a=c[1],r=void 0===c[3]?I:'"'===c[3]?M:_):r===M||r===_?r=I:r===C||r===D?r=S:(r=I,n=void 0);const h=r===I&&e[t+1].startsWith("/>")?" ":"";o+=r===S?s+v:l>=0?(i.push(a),s.slice(0,l)+"$lit$"+s.slice(l)+f+h):s+f+(-2===l?(i.push(void 0),t):h)}const a=o+(e[s]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==y?y.createHTML(a):a,i]};class L{constructor({strings:e,_$litType$:t},s){let i;this.parts=[];let n=0,o=0;const r=e.length-1,a=this.parts,[c,l]=U(e,t);if(this.el=L.createElement(c,s),P.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(i=P.nextNode())&&a.length<r;){if(1===i.nodeType){if(i.hasAttributes()){const e=[];for(const t of i.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(f)){const s=l[o++];if(e.push(t),void 0!==s){const e=i.getAttribute(s.toLowerCase()+"$lit$").split(f),t=/([.?@])?(.*)/.exec(s);a.push({type:1,index:n,name:t[2],strings:e,ctor:"."===t[1]?G:"?"===t[1]?z:"@"===t[1]?F:N})}else a.push({type:6,index:n})}for(const t of e)i.removeAttribute(t)}if(x.test(i.tagName)){const e=i.textContent.split(f),t=e.length-1;if(t>0){i.textContent=g?g.emptyScript:"";for(let s=0;s<t;s++)i.append(e[s],b()),P.nextNode(),a.push({type:2,index:++n});i.append(e[t],b())}}}else if(8===i.nodeType)if(i.data===m)a.push({type:2,index:n});else{let e=-1;for(;-1!==(e=i.data.indexOf(f,e+1));)a.push({type:7,index:n}),e+=f.length-1}n++}}static createElement(e,t){const s=w.createElement("template");return s.innerHTML=e,s}}function K(e,t,s=e,i){var n,o,r,a;if(t===B)return t;let c=void 0!==i?null===(n=s._$Cl)||void 0===n?void 0:n[i]:s._$Cu;const l=k(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==l&&(null===(o=null==c?void 0:c._$AO)||void 0===o||o.call(c,!1),void 0===l?c=void 0:(c=new l(e),c._$AT(e,s,i)),void 0!==i?(null!==(r=(a=s)._$Cl)&&void 0!==r?r:a._$Cl=[])[i]=c:s._$Cu=c),void 0!==c&&(t=K(e,c._$AS(e,t.values),c,i)),t}class j{constructor(e,t){this.v=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(e){var t;const{el:{content:s},parts:i}=this._$AD,n=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:w).importNode(s,!0);P.currentNode=n;let o=P.nextNode(),r=0,a=0,c=i[0];for(;void 0!==c;){if(r===c.index){let t;2===c.type?t=new H(o,o.nextSibling,this,e):1===c.type?t=new c.ctor(o,c.name,c.strings,this,e):6===c.type&&(t=new q(o,this,e)),this.v.push(t),c=i[++a]}r!==(null==c?void 0:c.index)&&(o=P.nextNode(),r++)}return n}m(e){let t=0;for(const s of this.v)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class H{constructor(e,t,s,i){var n;this.type=2,this._$AH=O,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=i,this._$C_=null===(n=null==i?void 0:i.isConnected)||void 0===n||n}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$C_}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=K(this,e,t),k(e)?e===O||null==e||""===e?(this._$AH!==O&&this._$AR(),this._$AH=O):e!==this._$AH&&e!==B&&this.T(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.k(e):A(e)?this.S(e):this.T(e)}j(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}k(e){this._$AH!==e&&(this._$AR(),this._$AH=this.j(e))}T(e){this._$AH!==O&&k(this._$AH)?this._$AA.nextSibling.data=e:this.k(w.createTextNode(e)),this._$AH=e}$(e){var t;const{values:s,_$litType$:i}=e,n="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=L.createElement(i.h,this.options)),i);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===n)this._$AH.m(s);else{const e=new j(n,this),t=e.p(this.options);e.m(s),this.k(t),this._$AH=e}}_$AC(e){let t=T.get(e.strings);return void 0===t&&T.set(e.strings,t=new L(e)),t}S(e){E(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,i=0;for(const n of e)i===t.length?t.push(s=new H(this.j(b()),this.j(b()),this,this.options)):s=t[i],s._$AI(n),i++;i<t.length&&(this._$AR(s&&s._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var s;for(null===(s=this._$AP)||void 0===s||s.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$C_=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class N{constructor(e,t,s,i,n){this.type=1,this._$AH=O,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=n,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=O}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,s,i){const n=this.strings;let o=!1;if(void 0===n)e=K(this,e,t,0),o=!k(e)||e!==this._$AH&&e!==B,o&&(this._$AH=e);else{const i=e;let r,a;for(e=n[0],r=0;r<n.length-1;r++)a=K(this,i[s+r],t,r),a===B&&(a=this._$AH[r]),o||(o=!k(a)||a!==this._$AH[r]),a===O?e=O:e!==O&&(e+=(null!=a?a:"")+n[r+1]),this._$AH[r]=a}o&&!i&&this.P(e)}P(e){e===O?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class G extends N{constructor(){super(...arguments),this.type=3}P(e){this.element[this.name]=e===O?void 0:e}}const R=g?g.emptyScript:"";class z extends N{constructor(){super(...arguments),this.type=4}P(e){e&&e!==O?this.element.setAttribute(this.name,R):this.element.removeAttribute(this.name)}}class F extends N{constructor(e,t,s,i,n){super(e,t,s,i,n),this.type=5}_$AI(e,t=this){var s;if((e=null!==(s=K(this,e,t,0))&&void 0!==s?s:O)===B)return;const i=this._$AH,n=e===O&&i!==O||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,o=e!==O&&(i===O||n);n&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,s;"function"==typeof this._$AH?this._$AH.call(null!==(s=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==s?s:this.element,e):this._$AH.handleEvent(e)}}class q{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){K(this,e)}}const W={A:"$lit$",C:f,M:m,L:1,R:U,V:j,D:A,I:K,H:H,N:N,U:z,B:F,F:G,W:q},Q=window.litHtmlPolyfillSupport;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var X,Y;null==Q||Q(L,H),(null!==(p=globalThis.litHtmlVersions)&&void 0!==p?p:globalThis.litHtmlVersions=[]).push("2.2.7");class J extends u{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const s=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=s.firstChild),s}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,s)=>{var i,n;const o=null!==(i=null==s?void 0:s.renderBefore)&&void 0!==i?i:t;let r=o._$litPart$;if(void 0===r){const e=null!==(n=null==s?void 0:s.renderBefore)&&void 0!==n?n:null;o._$litPart$=r=new H(t.insertBefore(b(),e),e,void 0,null!=s?s:{})}return r._$AI(e),r})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return B}}J.finalized=!0,J._$litElement$=!0,null===(X=globalThis.litElementHydrateSupport)||void 0===X||X.call(globalThis,{LitElement:J});const V=globalThis.litElementPolyfillSupport;null==V||V({LitElement:J}),(null!==(Y=globalThis.litElementVersions)&&void 0!==Y?Y:globalThis.litElementVersions=[]).push("3.2.2");customElements.define("toast-notification",class extends J{static properties={notification:{type:Object}};#e=!1;#t={success:"check",error:"times",warning:"triangle-exclamation"};#s=5e3;#i={};#n;#o;constructor(){super(),this.notification={type:"success",text:"Your changes has been saved"}}createRenderRoot(){return this}open(){this.#e&&(this.#i.style.animation="none",this.#i.style.width="100%",this.#i.style.animation=null,this.#i.classList.remove("active"),this.classList.remove("active"),clearTimeout(this.#n),clearTimeout(this.#o)),this.classList.add("active"),this.#i.classList.add("active"),this.#e=!0,this.#n=setTimeout((()=>{this.classList.remove("active"),this.isOpen=!1}),this.#s),this.#o=setTimeout((()=>this.#i.classList.remove("active")),this.#s+300)}close(){this.classList.remove("active"),clearTimeout(this.#n),clearTimeout(this.#o),setTimeout((()=>this.#i.classList.remove("active")),300),this.#n=null,this.#o=null,this.#e=!1}firstUpdated(){this.#i=this.querySelector(".progress")}render(){const e=this.#t[this.notification.type];return $`<div class="toast-content"><i class="fas fa-solid fa-${e} ${this.notification.type}"></i><div class="toast-message"><span class="text text-1">${this.notification.type.toUpperCase()}</span> <span class="text text-2">${this.notification.text}</span></div></div><i @click="${this.close}" class="fa-solid fa-xmark close hover-font"></i><div class="progress active ${this.notification.type}"></div>`}});class Z extends J{#r=!0;constructor(e=!0){if(super(),this.#r=e,this.classList="hide modal",this.setAttribute("data-open","false"),e)return this.#a()}#a(){this.addEventListener("click",(({target:e})=>{if(e.isSameNode(this))return this.close()}))}createRenderRoot(){return this}toggle(){return"true"===this.getAttribute("data-open")?this.close():this.open()}open(){const e="true"===this.getAttribute("data-open"),t=this.querySelector(".inner-modal");e||requestAnimationFrame((()=>(this.classList.remove("hide"),t.style="animation: fadeUpAnimation 0.3s !important;",this.setAttribute("data-open","true"))))}close(){const e="false"===this.getAttribute("data-open"),t=this.querySelector(".inner-modal");e||(t.style="animation: fadeDownAnimation 0.3s !important;",setTimeout((()=>(t.style="",this.classList.add("hide"),this.setAttribute("data-open","false"))),275))}set({HTML:e}){this.querySelector(".modal-content").innerHTML=e}setAndOpen(e){this.set(e),this.open()}render(e="",t=""){const s=this.#r?$`<small @click="${this.close}" class="close-modal unselectable">close</small>`:$``;return $`<div class="inner-modal">${s}<div class="modal-content">${e}</div><div class="modal-side">${t}</div></div>`}}customElements.define("modal-window",Z);
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ee=2,te=e=>(...t)=>({_$litDirective$:e,values:t});class se{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class ie extends se{constructor(e){if(super(e),this.it=O,e.type!==ee)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===O||null==e)return this._t=void 0,this.it=e;if(e===B)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}ie.directiveName="unsafeHTML",ie.resultType=1;const ne=te(ie),oe=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),re=/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;navigator.userAgent.indexOf("Firefox");const ae=!oe,ce={app:{},menus:{},threads:{},settings:{},user:{},navi:{},header:{},bottomNavi:{},toast:{}};var le=Object.freeze({THREADSTITLE:"Chats",INVITELINK:'We copied your <a class="highlight-color" href="{{link}}">invite link</a> to your clipboard. Go ahead and share it.',PANICTEXT:'Enter your Be8 id <i class="highlight-color">#{{id}}</i>&nbsp;&nbsp;to destroy your account and everything associated with it. Attention there is no way to restore your data!',CONVERSATION:"Enter a Be8 id to start a 1on1 chatting.",UNLOCKSETUPTEXT:"You have to remind your unlock code otherwise there is no way to access your account again! Enter your destroy code to destroy your acc! There is no way to recover destroyed accs",LEAVEGROUPADMIN:"When you leave this group, the group and every message gets destroyed, no way to recover any data.",LEAVEGROUPMEMBER:"Do you want to leave the group?",MESSAGEREMOVED:"The message was removed",MEMBERNOTEXISTING:"This member does not exist or turned off group features."}),de={id:"0",nickname:"User Name",expire:"Mon Jan 01 2222 00:00:00 GMT+0000 (Coordinated Universal Time)",type:"user",status:"Status Mockup",endless:!1,codes:!1};class he{static create(...e){return new this(...e)}mixIn(e){return Object.assign(this,e)}clone(){const e=new this.constructor;return Object.assign(e,this),e}}class ue extends he{constructor(e=[],t=4*e.length){super();let s=e;if(s instanceof ArrayBuffer&&(s=new Uint8Array(s)),(s instanceof Int8Array||s instanceof Uint8ClampedArray||s instanceof Int16Array||s instanceof Uint16Array||s instanceof Int32Array||s instanceof Uint32Array||s instanceof Float32Array||s instanceof Float64Array)&&(s=new Uint8Array(s.buffer,s.byteOffset,s.byteLength)),s instanceof Uint8Array){const e=s.byteLength,t=[];for(let i=0;i<e;i+=1)t[i>>>2]|=s[i]<<24-i%4*8;this.words=t,this.sigBytes=e}else this.words=e,this.sigBytes=t}static random(e){const t=[],s=e=>{let t=e,s=987654321;const i=4294967295;return()=>{s=36969*(65535&s)+(s>>16)&i,t=18e3*(65535&t)+(t>>16)&i;let e=(s<<16)+t&i;return e/=4294967296,e+=.5,e*(Math.random()>.5?1:-1)}};for(let i,n=0;n<e;n+=4){const e=s(4294967296*(i||Math.random()));i=987654071*e(),t.push(4294967296*e()|0)}return new ue(t,e)}toString(e=pe){return e.stringify(this)}concat(e){const t=this.words,s=e.words,i=this.sigBytes,n=e.sigBytes;if(this.clamp(),i%4)for(let e=0;e<n;e+=1){const n=s[e>>>2]>>>24-e%4*8&255;t[i+e>>>2]|=n<<24-(i+e)%4*8}else for(let e=0;e<n;e+=4)t[i+e>>>2]=s[e>>>2];return this.sigBytes+=n,this}clamp(){const{words:e,sigBytes:t}=this;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}clone(){const e=super.clone.call(this);return e.words=this.words.slice(0),e}}const pe={stringify(e){const{words:t,sigBytes:s}=e,i=[];for(let e=0;e<s;e+=1){const s=t[e>>>2]>>>24-e%4*8&255;i.push((s>>>4).toString(16)),i.push((15&s).toString(16))}return i.join("")},parse(e){const t=e.length,s=[];for(let i=0;i<t;i+=2)s[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new ue(s,t/2)}},ge={stringify(e){const{words:t,sigBytes:s}=e,i=[];for(let e=0;e<s;e+=1){const s=t[e>>>2]>>>24-e%4*8&255;i.push(String.fromCharCode(s))}return i.join("")},parse(e){const t=e.length,s=[];for(let i=0;i<t;i+=1)s[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new ue(s,t)}},ye={stringify(e){try{return decodeURIComponent(escape(ge.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:e=>ge.parse(unescape(encodeURIComponent(e)))};class fe extends he{constructor(){super(),this._minBufferSize=0}reset(){this._data=new ue,this._nDataBytes=0}_append(e){let t=e;"string"==typeof t&&(t=ye.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(e){let t;const{_data:s,blockSize:i}=this,n=s.words,o=s.sigBytes;let r=o/(4*i);r=e?Math.ceil(r):Math.max((0|r)-this._minBufferSize,0);const a=r*i,c=Math.min(4*a,o);if(a){for(let e=0;e<a;e+=i)this._doProcessBlock(n,e);t=n.splice(0,a),s.sigBytes-=c}return new ue(t,c)}clone(){const e=super.clone.call(this);return e._data=this._data.clone(),e}}class me extends fe{constructor(e){super(),this.blockSize=16,this.cfg=Object.assign(new he,e),this.reset()}static _createHelper(e){return(t,s)=>new e(s).finalize(t)}static _createHmacHelper(e){return(t,s)=>new ve(e,s).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e);return this._doFinalize()}}class ve extends he{constructor(e,t){super();const s=new e;this._hasher=s;let i=t;"string"==typeof i&&(i=ye.parse(i));const n=s.blockSize,o=4*n;i.sigBytes>o&&(i=s.finalize(t)),i.clamp();const r=i.clone();this._oKey=r;const a=i.clone();this._iKey=a;const c=r.words,l=a.words;for(let e=0;e<n;e+=1)c[e]^=1549556828,l[e]^=909522486;r.sigBytes=o,a.sigBytes=o,this.reset()}reset(){const e=this._hasher;e.reset(),e.update(this._iKey)}update(e){return this._hasher.update(e),this}finalize(e){const t=this._hasher,s=t.finalize(e);t.reset();return t.finalize(this._oKey.clone().concat(s))}}const we=ue;class be extends he{constructor(e,t){super(),this.high=e,this.low=t}}class ke extends he{constructor(e=[],t=8*e.length){super(),this.words=e,this.sigBytes=t}toX32(){const e=this.words,t=e.length,s=[];for(let i=0;i<t;i+=1){const t=e[i];s.push(t.high),s.push(t.low)}return we.create(s,this.sigBytes)}clone(){const e=super.clone.call(this);e.words=this.words.slice(0);const{words:t}=e,s=t.length;for(let e=0;e<s;e+=1)t[e]=t[e].clone();return e}}const Ee={stringify(e){const{words:t,sigBytes:s}=e,i=this._map;e.clamp();const n=[];for(let e=0;e<s;e+=3){const o=(t[e>>>2]>>>24-e%4*8&255)<<16|(t[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|t[e+2>>>2]>>>24-(e+2)%4*8&255;for(let t=0;t<4&&e+.75*t<s;t+=1)n.push(i.charAt(o>>>6*(3-t)&63))}const o=i.charAt(64);if(o)for(;n.length%4;)n.push(o);return n.join("")},parse(e){let t=e.length;const s=this._map;let i=this._reverseMap;if(!i){this._reverseMap=[],i=this._reverseMap;for(let e=0;e<s.length;e+=1)i[s.charCodeAt(e)]=e}const n=s.charAt(64);if(n){const s=e.indexOf(n);-1!==s&&(t=s)}return((e,t,s)=>{const i=[];let n=0;for(let o=0;o<t;o+=1)if(o%4){const t=s[e.charCodeAt(o-1)]<<o%4*2|s[e.charCodeAt(o)]>>>6-o%4*2;i[n>>>2]|=t<<24-n%4*8,n+=1}return ue.create(i,n)})(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},Ae=[];for(let e=0;e<64;e+=1)Ae[e]=4294967296*Math.abs(Math.sin(e+1))|0;const Se=(e,t,s,i,n,o,r)=>{const a=e+(t&s|~t&i)+n+r;return(a<<o|a>>>32-o)+t},Ce=(e,t,s,i,n,o,r)=>{const a=e+(t&i|s&~i)+n+r;return(a<<o|a>>>32-o)+t},De=(e,t,s,i,n,o,r)=>{const a=e+(t^s^i)+n+r;return(a<<o|a>>>32-o)+t},Ie=(e,t,s,i,n,o,r)=>{const a=e+(s^(t|~i))+n+r;return(a<<o|a>>>32-o)+t};class _e extends me{_doReset(){this._hash=new ue([1732584193,4023233417,2562383102,271733878])}_doProcessBlock(e,t){const s=e;for(let i=0;i<16;i+=1){const n=t+i,o=e[n];s[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}const i=this._hash.words,n=s[t+0],o=s[t+1],r=s[t+2],a=s[t+3],c=s[t+4],l=s[t+5],d=s[t+6],h=s[t+7],u=s[t+8],p=s[t+9],g=s[t+10],y=s[t+11],f=s[t+12],m=s[t+13],v=s[t+14],w=s[t+15];let b=i[0],k=i[1],E=i[2],A=i[3];b=Se(b,k,E,A,n,7,Ae[0]),A=Se(A,b,k,E,o,12,Ae[1]),E=Se(E,A,b,k,r,17,Ae[2]),k=Se(k,E,A,b,a,22,Ae[3]),b=Se(b,k,E,A,c,7,Ae[4]),A=Se(A,b,k,E,l,12,Ae[5]),E=Se(E,A,b,k,d,17,Ae[6]),k=Se(k,E,A,b,h,22,Ae[7]),b=Se(b,k,E,A,u,7,Ae[8]),A=Se(A,b,k,E,p,12,Ae[9]),E=Se(E,A,b,k,g,17,Ae[10]),k=Se(k,E,A,b,y,22,Ae[11]),b=Se(b,k,E,A,f,7,Ae[12]),A=Se(A,b,k,E,m,12,Ae[13]),E=Se(E,A,b,k,v,17,Ae[14]),k=Se(k,E,A,b,w,22,Ae[15]),b=Ce(b,k,E,A,o,5,Ae[16]),A=Ce(A,b,k,E,d,9,Ae[17]),E=Ce(E,A,b,k,y,14,Ae[18]),k=Ce(k,E,A,b,n,20,Ae[19]),b=Ce(b,k,E,A,l,5,Ae[20]),A=Ce(A,b,k,E,g,9,Ae[21]),E=Ce(E,A,b,k,w,14,Ae[22]),k=Ce(k,E,A,b,c,20,Ae[23]),b=Ce(b,k,E,A,p,5,Ae[24]),A=Ce(A,b,k,E,v,9,Ae[25]),E=Ce(E,A,b,k,a,14,Ae[26]),k=Ce(k,E,A,b,u,20,Ae[27]),b=Ce(b,k,E,A,m,5,Ae[28]),A=Ce(A,b,k,E,r,9,Ae[29]),E=Ce(E,A,b,k,h,14,Ae[30]),k=Ce(k,E,A,b,f,20,Ae[31]),b=De(b,k,E,A,l,4,Ae[32]),A=De(A,b,k,E,u,11,Ae[33]),E=De(E,A,b,k,y,16,Ae[34]),k=De(k,E,A,b,v,23,Ae[35]),b=De(b,k,E,A,o,4,Ae[36]),A=De(A,b,k,E,c,11,Ae[37]),E=De(E,A,b,k,h,16,Ae[38]),k=De(k,E,A,b,g,23,Ae[39]),b=De(b,k,E,A,m,4,Ae[40]),A=De(A,b,k,E,n,11,Ae[41]),E=De(E,A,b,k,a,16,Ae[42]),k=De(k,E,A,b,d,23,Ae[43]),b=De(b,k,E,A,p,4,Ae[44]),A=De(A,b,k,E,f,11,Ae[45]),E=De(E,A,b,k,w,16,Ae[46]),k=De(k,E,A,b,r,23,Ae[47]),b=Ie(b,k,E,A,n,6,Ae[48]),A=Ie(A,b,k,E,h,10,Ae[49]),E=Ie(E,A,b,k,v,15,Ae[50]),k=Ie(k,E,A,b,l,21,Ae[51]),b=Ie(b,k,E,A,f,6,Ae[52]),A=Ie(A,b,k,E,a,10,Ae[53]),E=Ie(E,A,b,k,g,15,Ae[54]),k=Ie(k,E,A,b,o,21,Ae[55]),b=Ie(b,k,E,A,u,6,Ae[56]),A=Ie(A,b,k,E,w,10,Ae[57]),E=Ie(E,A,b,k,d,15,Ae[58]),k=Ie(k,E,A,b,m,21,Ae[59]),b=Ie(b,k,E,A,c,6,Ae[60]),A=Ie(A,b,k,E,y,10,Ae[61]),E=Ie(E,A,b,k,r,15,Ae[62]),k=Ie(k,E,A,b,p,21,Ae[63]),i[0]=i[0]+b|0,i[1]=i[1]+k|0,i[2]=i[2]+E|0,i[3]=i[3]+A|0}_doFinalize(){const e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32;const n=Math.floor(s/4294967296),o=s;t[15+(i+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(t.length+1),this._process();const r=this._hash,a=r.words;for(let e=0;e<4;e+=1){const t=a[e];a[e]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8)}return r}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const Me=me._createHelper(_e),xe=me._createHmacHelper(_e);class $e extends he{constructor(e){super(),this.cfg=Object.assign(new he,{keySize:4,hasher:_e,iterations:1},e)}compute(e,t){let s;const{cfg:i}=this,n=i.hasher.create(),o=ue.create(),r=o.words,{keySize:a,iterations:c}=i;for(;r.length<a;){s&&n.update(s),s=n.update(e).finalize(t),n.reset();for(let e=1;e<c;e+=1)s=n.finalize(s),n.reset();o.concat(s)}return o.sigBytes=4*a,o}}class Be extends fe{constructor(e,t,s){super(),this.cfg=Object.assign(new he,s),this._xformMode=e,this._key=t,this.reset()}static createEncryptor(e,t){return this.create(this._ENC_XFORM_MODE,e,t)}static createDecryptor(e,t){return this.create(this._DEC_XFORM_MODE,e,t)}static _createHelper(e){const t=e=>"string"==typeof e?Re:Ne;return{encrypt:(s,i,n)=>t(i).encrypt(e,s,i,n),decrypt:(s,i,n)=>t(i).decrypt(e,s,i,n)}}reset(){super.reset.call(this),this._doReset()}process(e){return this._append(e),this._process()}finalize(e){e&&this._append(e);return this._doFinalize()}}Be._ENC_XFORM_MODE=1,Be._DEC_XFORM_MODE=2,Be.keySize=4,Be.ivSize=4;class Oe extends Be{constructor(...e){super(...e),this.blockSize=1}_doFinalize(){return this._process(!0)}}class Te extends he{constructor(e,t){super(),this._cipher=e,this._iv=t}static createEncryptor(e,t){return this.Encryptor.create(e,t)}static createDecryptor(e,t){return this.Decryptor.create(e,t)}}function Pe(e,t,s){const i=e;let n;const o=this._iv;o?(n=o,this._iv=void 0):n=this._prevBlock;for(let e=0;e<s;e+=1)i[t+e]^=n[e]}class Ue extends Te{}Ue.Encryptor=class extends Ue{processBlock(e,t){const s=this._cipher,{blockSize:i}=s;Pe.call(this,e,t,i),s.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}},Ue.Decryptor=class extends Ue{processBlock(e,t){const s=this._cipher,{blockSize:i}=s,n=e.slice(t,t+i);s.decryptBlock(e,t),Pe.call(this,e,t,i),this._prevBlock=n}};const Le={pad(e,t){const s=4*t,i=s-e.sigBytes%s,n=i<<24|i<<16|i<<8|i,o=[];for(let e=0;e<i;e+=4)o.push(n);const r=ue.create(o,i);e.concat(r)},unpad(e){const t=e,s=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=s}};class Ke extends Be{constructor(e,t,s){super(e,t,Object.assign({mode:Ue,padding:Le},s)),this.blockSize=4}reset(){let e;super.reset.call(this);const{cfg:t}=this,{iv:s,mode:i}=t;this._xformMode===this.constructor._ENC_XFORM_MODE?e=i.createEncryptor:(e=i.createDecryptor,this._minBufferSize=1),this._mode=e.call(i,this,s&&s.words),this._mode.__creator=e}_doProcessBlock(e,t){this._mode.processBlock(e,t)}_doFinalize(){let e;const{padding:t}=this.cfg;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e}}class je extends he{constructor(e){super(),this.mixIn(e)}toString(e){return(e||this.formatter).stringify(this)}}const He={stringify(e){let t;const{ciphertext:s,salt:i}=e;return t=i?ue.create([1398893684,1701076831]).concat(i).concat(s):s,t.toString(Ee)},parse(e){let t;const s=Ee.parse(e),i=s.words;return 1398893684===i[0]&&1701076831===i[1]&&(t=ue.create(i.slice(2,4)),i.splice(0,4),s.sigBytes-=16),je.create({ciphertext:s,salt:t})}};class Ne extends he{static encrypt(e,t,s,i){const n=Object.assign(new he,this.cfg,i),o=e.createEncryptor(s,n),r=o.finalize(t),a=o.cfg;return je.create({ciphertext:r,key:s,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:o.blockSize,formatter:n.format})}static decrypt(e,t,s,i){let n=t;const o=Object.assign(new he,this.cfg,i);n=this._parse(n,o.format);return e.createDecryptor(s,o).finalize(n.ciphertext)}static _parse(e,t){return"string"==typeof e?t.parse(e,this):e}}Ne.cfg=Object.assign(new he,{format:He});const Ge={execute(e,t,s,i){let n=i;n||(n=ue.random(8));const o=$e.create({keySize:t+s}).compute(e,n),r=ue.create(o.words.slice(t),4*s);return o.sigBytes=4*t,je.create({key:o,iv:r,salt:n})}};class Re extends Ne{static encrypt(e,t,s,i){const n=Object.assign(new he,this.cfg,i),o=n.kdf.execute(s,e.keySize,e.ivSize);n.iv=o.iv;const r=Ne.encrypt.call(this,e,t,o.key,n);return r.mixIn(o),r}static decrypt(e,t,s,i){let n=t;const o=Object.assign(new he,this.cfg,i);n=this._parse(n,o.format);const r=o.kdf.execute(s,e.keySize,e.ivSize,n.salt);o.iv=r.iv;return Ne.decrypt.call(this,e,n,r.key,o)}}Re.cfg=Object.assign(Ne.cfg,{kdf:Ge});const ze=e=>e<<8&4278255360|e>>>8&16711935,Fe={stringify(e){const{words:t,sigBytes:s}=e,i=[];for(let e=0;e<s;e+=2){const s=t[e>>>2]>>>16-e%4*8&65535;i.push(String.fromCharCode(s))}return i.join("")},parse(e){const t=e.length,s=[];for(let i=0;i<t;i+=1)s[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return ue.create(s,2*t)}},qe=Fe,We={stringify(e){const{words:t,sigBytes:s}=e,i=[];for(let e=0;e<s;e+=2){const s=ze(t[e>>>2]>>>16-e%4*8&65535);i.push(String.fromCharCode(s))}return i.join("")},parse(e){const t=e.length,s=[];for(let i=0;i<t;i+=1)s[i>>>1]|=ze(e.charCodeAt(i)<<16-i%2*16);return ue.create(s,2*t)}},Qe=[];class Xe extends me{_doReset(){this._hash=new ue([1732584193,4023233417,2562383102,271733878,3285377520])}_doProcessBlock(e,t){const s=this._hash.words;let i=s[0],n=s[1],o=s[2],r=s[3],a=s[4];for(let s=0;s<80;s+=1){if(s<16)Qe[s]=0|e[t+s];else{const e=Qe[s-3]^Qe[s-8]^Qe[s-14]^Qe[s-16];Qe[s]=e<<1|e>>>31}let c=(i<<5|i>>>27)+a+Qe[s];c+=s<20?1518500249+(n&o|~n&r):s<40?1859775393+(n^o^r):s<60?(n&o|n&r|o&r)-1894007588:(n^o^r)-899497514,a=r,r=o,o=n<<30|n>>>2,n=i,i=c}s[0]=s[0]+i|0,s[1]=s[1]+n|0,s[2]=s[2]+o|0,s[3]=s[3]+r|0,s[4]=s[4]+a|0}_doFinalize(){const e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(s/4294967296),t[15+(i+64>>>9<<4)]=s,e.sigBytes=4*t.length,this._process(),this._hash}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const Ye=me._createHelper(Xe),Je=me._createHmacHelper(Xe),Ve=[],Ze=[],et=e=>{const t=Math.sqrt(e);for(let s=2;s<=t;s+=1)if(!(e%s))return!1;return!0},tt=e=>4294967296*(e-(0|e))|0;let st=2,it=0;for(;it<64;)et(st)&&(it<8&&(Ve[it]=tt(st**.5)),Ze[it]=tt(st**(1/3)),it+=1),st+=1;const nt=[];class ot extends me{_doReset(){this._hash=new ue(Ve.slice(0))}_doProcessBlock(e,t){const s=this._hash.words;let i=s[0],n=s[1],o=s[2],r=s[3],a=s[4],c=s[5],l=s[6],d=s[7];for(let s=0;s<64;s+=1){if(s<16)nt[s]=0|e[t+s];else{const e=nt[s-15],t=(e<<25|e>>>7)^(e<<14|e>>>18)^e>>>3,i=nt[s-2],n=(i<<15|i>>>17)^(i<<13|i>>>19)^i>>>10;nt[s]=t+nt[s-7]+n+nt[s-16]}const h=i&n^i&o^n&o,u=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),p=d+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&l)+Ze[s]+nt[s];d=l,l=c,c=a,a=r+p|0,r=o,o=n,n=i,i=p+(u+h)|0}s[0]=s[0]+i|0,s[1]=s[1]+n|0,s[2]=s[2]+o|0,s[3]=s[3]+r|0,s[4]=s[4]+a|0,s[5]=s[5]+c|0,s[6]=s[6]+l|0,s[7]=s[7]+d|0}_doFinalize(){const e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=Math.floor(s/4294967296),t[15+(i+64>>>9<<4)]=s,e.sigBytes=4*t.length,this._process(),this._hash}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const rt=me._createHelper(ot),at=me._createHmacHelper(ot);class ct extends ot{_doReset(){this._hash=new ue([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])}_doFinalize(){const e=super._doFinalize.call(this);return e.sigBytes-=4,e}}const lt=ot._createHelper(ct),dt=ot._createHmacHelper(ct),ht=[new be(1116352408,3609767458),new be(1899447441,602891725),new be(3049323471,3964484399),new be(3921009573,2173295548),new be(961987163,4081628472),new be(1508970993,3053834265),new be(2453635748,2937671579),new be(2870763221,3664609560),new be(3624381080,2734883394),new be(310598401,1164996542),new be(607225278,1323610764),new be(1426881987,3590304994),new be(1925078388,4068182383),new be(2162078206,991336113),new be(2614888103,633803317),new be(3248222580,3479774868),new be(3835390401,2666613458),new be(4022224774,944711139),new be(264347078,2341262773),new be(604807628,2007800933),new be(770255983,1495990901),new be(1249150122,1856431235),new be(1555081692,3175218132),new be(1996064986,2198950837),new be(2554220882,3999719339),new be(2821834349,766784016),new be(2952996808,2566594879),new be(3210313671,3203337956),new be(3336571891,1034457026),new be(3584528711,2466948901),new be(113926993,3758326383),new be(338241895,168717936),new be(666307205,1188179964),new be(773529912,1546045734),new be(1294757372,1522805485),new be(1396182291,2643833823),new be(1695183700,2343527390),new be(1986661051,1014477480),new be(2177026350,1206759142),new be(2456956037,344077627),new be(2730485921,1290863460),new be(2820302411,3158454273),new be(3259730800,3505952657),new be(3345764771,106217008),new be(3516065817,3606008344),new be(3600352804,1432725776),new be(4094571909,1467031594),new be(275423344,851169720),new be(430227734,3100823752),new be(506948616,1363258195),new be(659060556,3750685593),new be(883997877,3785050280),new be(958139571,3318307427),new be(1322822218,3812723403),new be(1537002063,2003034995),new be(1747873779,3602036899),new be(1955562222,1575990012),new be(2024104815,1125592928),new be(2227730452,2716904306),new be(2361852424,442776044),new be(2428436474,593698344),new be(2756734187,3733110249),new be(3204031479,2999351573),new be(3329325298,3815920427),new be(3391569614,3928383900),new be(3515267271,566280711),new be(3940187606,3454069534),new be(4118630271,4000239992),new be(116418474,1914138554),new be(174292421,2731055270),new be(289380356,3203993006),new be(460393269,320620315),new be(685471733,587496836),new be(852142971,1086792851),new be(1017036298,365543100),new be(1126000580,2618297676),new be(1288033470,3409855158),new be(1501505948,4234509866),new be(1607167915,987167468),new be(1816402316,1246189591)],ut=[];for(let e=0;e<80;e+=1)ut[e]=new be;class pt extends me{constructor(){super(),this.blockSize=32}_doReset(){this._hash=new ke([new be(1779033703,4089235720),new be(3144134277,2227873595),new be(1013904242,4271175723),new be(2773480762,1595750129),new be(1359893119,2917565137),new be(2600822924,725511199),new be(528734635,4215389547),new be(1541459225,327033209)])}_doProcessBlock(e,t){const s=this._hash.words,i=s[0],n=s[1],o=s[2],r=s[3],a=s[4],c=s[5],l=s[6],d=s[7],h=i.high;let u=i.low;const p=n.high;let g=n.low;const y=o.high;let f=o.low;const m=r.high;let v=r.low;const w=a.high;let b=a.low;const k=c.high;let E=c.low;const A=l.high;let S=l.low;const C=d.high;let D=d.low,I=h,_=u,M=p,x=g,$=y,B=f,O=m,T=v,P=w,U=b,L=k,K=E,j=A,H=S,N=C,G=D;for(let s=0;s<80;s+=1){let i,n;const o=ut[s];if(s<16)o.high=0|e[t+2*s],n=o.high,o.low=0|e[t+2*s+1],i=o.low;else{const e=ut[s-15],t=e.high,r=e.low,a=(t>>>1|r<<31)^(t>>>8|r<<24)^t>>>7,c=(r>>>1|t<<31)^(r>>>8|t<<24)^(r>>>7|t<<25),l=ut[s-2],d=l.high,h=l.low,u=(d>>>19|h<<13)^(d<<3|h>>>29)^d>>>6,p=(h>>>19|d<<13)^(h<<3|d>>>29)^(h>>>6|d<<26),g=ut[s-7],y=g.high,f=g.low,m=ut[s-16],v=m.high,w=m.low;i=c+f,n=a+y+(i>>>0<c>>>0?1:0),i+=p,n=n+u+(i>>>0<p>>>0?1:0),i+=w,n=n+v+(i>>>0<w>>>0?1:0),o.high=n,o.low=i}const r=P&L^~P&j,a=U&K^~U&H,c=I&M^I&$^M&$,l=_&x^_&B^x&B,d=(I>>>28|_<<4)^(I<<30|_>>>2)^(I<<25|_>>>7),h=(_>>>28|I<<4)^(_<<30|I>>>2)^(_<<25|I>>>7),u=(P>>>14|U<<18)^(P>>>18|U<<14)^(P<<23|U>>>9),p=(U>>>14|P<<18)^(U>>>18|P<<14)^(U<<23|P>>>9),g=ht[s],y=g.high,f=g.low;let m=G+p,v=N+u+(m>>>0<G>>>0?1:0);m+=a,v=v+r+(m>>>0<a>>>0?1:0),m+=f,v=v+y+(m>>>0<f>>>0?1:0),m+=i,v=v+n+(m>>>0<i>>>0?1:0);const w=h+l;N=j,G=H,j=L,H=K,L=P,K=U,U=T+m|0,P=O+v+(U>>>0<T>>>0?1:0)|0,O=$,T=B,$=M,B=x,M=I,x=_,_=m+w|0,I=v+(d+c+(w>>>0<h>>>0?1:0))+(_>>>0<m>>>0?1:0)|0}i.low=u+_,u=i.low,i.high=h+I+(u>>>0<_>>>0?1:0),n.low=g+x,g=n.low,n.high=p+M+(g>>>0<x>>>0?1:0),o.low=f+B,f=o.low,o.high=y+$+(f>>>0<B>>>0?1:0),r.low=v+T,v=r.low,r.high=m+O+(v>>>0<T>>>0?1:0),a.low=b+U,b=a.low,a.high=w+P+(b>>>0<U>>>0?1:0),c.low=E+K,E=c.low,c.high=k+L+(E>>>0<K>>>0?1:0),l.low=S+H,S=l.low,l.high=A+j+(S>>>0<H>>>0?1:0),d.low=D+G,D=d.low,d.high=C+N+(D>>>0<G>>>0?1:0)}_doFinalize(){const e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[30+(i+128>>>10<<5)]=Math.floor(s/4294967296),t[31+(i+128>>>10<<5)]=s,e.sigBytes=4*t.length,this._process();return this._hash.toX32()}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const gt=me._createHelper(pt),yt=me._createHmacHelper(pt);class ft extends pt{_doReset(){this._hash=new ke([new be(3418070365,3238371032),new be(1654270250,914150663),new be(2438529370,812702999),new be(355462360,4144912697),new be(1731405415,4290775857),new be(2394180231,1750603025),new be(3675008525,1694076839),new be(1203062813,3204075428)])}_doFinalize(){const e=super._doFinalize.call(this);return e.sigBytes-=16,e}}const mt=pt._createHelper(ft),vt=pt._createHmacHelper(ft),wt=[],bt=[],kt=[];let Et=1,At=0;for(let e=0;e<24;e+=1){wt[Et+5*At]=(e+1)*(e+2)/2%64;const t=(2*Et+3*At)%5;Et=At%5,At=t}for(let e=0;e<5;e+=1)for(let t=0;t<5;t+=1)bt[e+5*t]=t+(2*e+3*t)%5*5;let St=1;for(let e=0;e<24;e+=1){let t=0,s=0;for(let e=0;e<7;e+=1){if(1&St){const i=(1<<e)-1;i<32?s^=1<<i:t^=1<<i-32}128&St?St=St<<1^113:St<<=1}kt[e]=be.create(t,s)}const Ct=[];for(let e=0;e<25;e+=1)Ct[e]=be.create();class Dt extends me{constructor(e){super(Object.assign({outputLength:512},e))}_doReset(){this._state=[];const e=this._state;for(let t=0;t<25;t+=1)e[t]=new be;this.blockSize=(1600-2*this.cfg.outputLength)/32}_doProcessBlock(e,t){const s=this._state,i=this.blockSize/2;for(let n=0;n<i;n+=1){let i=e[t+2*n],o=e[t+2*n+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);const r=s[n];r.high^=o,r.low^=i}for(let e=0;e<24;e+=1){for(let e=0;e<5;e+=1){let t=0,i=0;for(let n=0;n<5;n+=1){const o=s[e+5*n];t^=o.high,i^=o.low}const n=Ct[e];n.high=t,n.low=i}for(let e=0;e<5;e+=1){const t=Ct[(e+4)%5],i=Ct[(e+1)%5],n=i.high,o=i.low,r=t.high^(n<<1|o>>>31),a=t.low^(o<<1|n>>>31);for(let t=0;t<5;t+=1){const i=s[e+5*t];i.high^=r,i.low^=a}}for(let e=1;e<25;e+=1){let t,i;const n=s[e],o=n.high,r=n.low,a=wt[e];a<32?(t=o<<a|r>>>32-a,i=r<<a|o>>>32-a):(t=r<<a-32|o>>>64-a,i=o<<a-32|r>>>64-a);const c=Ct[bt[e]];c.high=t,c.low=i}const t=Ct[0],i=s[0];t.high=i.high,t.low=i.low;for(let e=0;e<5;e+=1)for(let t=0;t<5;t+=1){const i=e+5*t,n=s[i],o=Ct[i],r=Ct[(e+1)%5+5*t],a=Ct[(e+2)%5+5*t];n.high=o.high^~r.high&a.high,n.low=o.low^~r.low&a.low}const n=s[0],o=kt[e];n.high^=o.high,n.low^=o.low}}_doFinalize(){const e=this._data,t=e.words,s=8*e.sigBytes,i=32*this.blockSize;t[s>>>5]|=1<<24-s%32,t[(Math.ceil((s+1)/i)*i>>>5)-1]|=128,e.sigBytes=4*t.length,this._process();const n=this._state,o=this.cfg.outputLength/8,r=o/8,a=[];for(let e=0;e<r;e+=1){const t=n[e];let s=t.high,i=t.low;s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),a.push(i),a.push(s)}return new ue(a,o)}clone(){const e=super.clone.call(this);e._state=this._state.slice(0);const t=e._state;for(let e=0;e<25;e+=1)t[e]=t[e].clone();return e}}const It=me._createHelper(Dt),_t=me._createHmacHelper(Dt),Mt=ue.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),xt=ue.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),$t=ue.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),Bt=ue.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),Ot=ue.create([0,1518500249,1859775393,2400959708,2840853838]),Tt=ue.create([1352829926,1548603684,1836072691,2053994217,0]),Pt=(e,t,s)=>e^t^s,Ut=(e,t,s)=>e&t|~e&s,Lt=(e,t,s)=>(e|~t)^s,Kt=(e,t,s)=>e&s|t&~s,jt=(e,t,s)=>e^(t|~s),Ht=(e,t)=>e<<t|e>>>32-t;class Nt extends me{_doReset(){this._hash=ue.create([1732584193,4023233417,2562383102,271733878,3285377520])}_doProcessBlock(e,t){const s=e;for(let e=0;e<16;e+=1){const i=t+e,n=s[i];s[i]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}const i=this._hash.words,n=Ot.words,o=Tt.words,r=Mt.words,a=xt.words,c=$t.words,l=Bt.words;let d,h=i[0],u=i[1],p=i[2],g=i[3],y=i[4],f=i[0],m=i[1],v=i[2],w=i[3],b=i[4];for(let e=0;e<80;e+=1)d=h+s[t+r[e]]|0,d+=e<16?Pt(u,p,g)+n[0]:e<32?Ut(u,p,g)+n[1]:e<48?Lt(u,p,g)+n[2]:e<64?Kt(u,p,g)+n[3]:jt(u,p,g)+n[4],d|=0,d=Ht(d,c[e]),d=d+y|0,h=y,y=g,g=Ht(p,10),p=u,u=d,d=f+s[t+a[e]]|0,d+=e<16?jt(m,v,w)+o[0]:e<32?Kt(m,v,w)+o[1]:e<48?Lt(m,v,w)+o[2]:e<64?Ut(m,v,w)+o[3]:Pt(m,v,w)+o[4],d|=0,d=Ht(d,l[e]),d=d+b|0,f=b,b=w,w=Ht(v,10),v=m,m=d;d=i[1]+p+w|0,i[1]=i[2]+g+b|0,i[2]=i[3]+y+f|0,i[3]=i[4]+h+m|0,i[4]=i[0]+u+v|0,i[0]=d}_doFinalize(){const e=this._data,t=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(t.length+1),this._process();const n=this._hash,o=n.words;for(let e=0;e<5;e+=1){const t=o[e];o[e]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8)}return n}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const Gt=me._createHelper(Nt),Rt=me._createHmacHelper(Nt);class zt extends he{constructor(e){super(),this.cfg=Object.assign(new he,{keySize:4,hasher:Xe,iterations:1},e)}compute(e,t){const{cfg:s}=this,i=ve.create(s.hasher,e),n=ue.create(),o=ue.create([1]),r=n.words,a=o.words,{keySize:c,iterations:l}=s;for(;r.length<c;){const e=i.update(t).finalize(o);i.reset();const s=e.words,r=s.length;let c=e;for(let e=1;e<l;e+=1){c=i.finalize(c),i.reset();const e=c.words;for(let t=0;t<r;t+=1)s[t]^=e[t]}n.concat(e),a[0]+=1}return n.sigBytes=4*c,n}}const Ft=[],qt=[],Wt=[],Qt=[],Xt=[],Yt=[],Jt=[],Vt=[],Zt=[],es=[],ts=[];for(let e=0;e<256;e+=1)ts[e]=e<128?e<<1:e<<1^283;let ss=0,is=0;for(let e=0;e<256;e+=1){let e=is^is<<1^is<<2^is<<3^is<<4;e=e>>>8^255&e^99,Ft[ss]=e,qt[e]=ss;const t=ts[ss],s=ts[t],i=ts[s];let n=257*ts[e]^16843008*e;Wt[ss]=n<<24|n>>>8,Qt[ss]=n<<16|n>>>16,Xt[ss]=n<<8|n>>>24,Yt[ss]=n,n=16843009*i^65537*s^257*t^16843008*ss,Jt[e]=n<<24|n>>>8,Vt[e]=n<<16|n>>>16,Zt[e]=n<<8|n>>>24,es[e]=n,ss?(ss=t^ts[ts[ts[i^t]]],is^=ts[ts[is]]):(is=1,ss=is)}const ns=[0,1,2,4,8,16,32,64,128,27,54];class os extends Ke{_doReset(){let e;if(this._nRounds&&this._keyPriorReset===this._key)return;this._keyPriorReset=this._key;const t=this._keyPriorReset,s=t.words,i=t.sigBytes/4;this._nRounds=i+6;const n=4*(this._nRounds+1);this._keySchedule=[];const o=this._keySchedule;for(let t=0;t<n;t+=1)t<i?o[t]=s[t]:(e=o[t-1],t%i?i>6&&t%i==4&&(e=Ft[e>>>24]<<24|Ft[e>>>16&255]<<16|Ft[e>>>8&255]<<8|Ft[255&e]):(e=e<<8|e>>>24,e=Ft[e>>>24]<<24|Ft[e>>>16&255]<<16|Ft[e>>>8&255]<<8|Ft[255&e],e^=ns[t/i|0]<<24),o[t]=o[t-i]^e);this._invKeySchedule=[];const r=this._invKeySchedule;for(let t=0;t<n;t+=1){const s=n-t;e=t%4?o[s]:o[s-4],r[t]=t<4||s<=4?e:Jt[Ft[e>>>24]]^Vt[Ft[e>>>16&255]]^Zt[Ft[e>>>8&255]]^es[Ft[255&e]]}}encryptBlock(e,t){this._doCryptBlock(e,t,this._keySchedule,Wt,Qt,Xt,Yt,Ft)}decryptBlock(e,t){const s=e;let i=s[t+1];s[t+1]=s[t+3],s[t+3]=i,this._doCryptBlock(s,t,this._invKeySchedule,Jt,Vt,Zt,es,qt),i=s[t+1],s[t+1]=s[t+3],s[t+3]=i}_doCryptBlock(e,t,s,i,n,o,r,a){const c=e,l=this._nRounds;let d=c[t]^s[0],h=c[t+1]^s[1],u=c[t+2]^s[2],p=c[t+3]^s[3],g=4;for(let e=1;e<l;e+=1){const e=i[d>>>24]^n[h>>>16&255]^o[u>>>8&255]^r[255&p]^s[g];g+=1;const t=i[h>>>24]^n[u>>>16&255]^o[p>>>8&255]^r[255&d]^s[g];g+=1;const a=i[u>>>24]^n[p>>>16&255]^o[d>>>8&255]^r[255&h]^s[g];g+=1;const c=i[p>>>24]^n[d>>>16&255]^o[h>>>8&255]^r[255&u]^s[g];g+=1,d=e,h=t,u=a,p=c}const y=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&p])^s[g];g+=1;const f=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[p>>>8&255]<<8|a[255&d])^s[g];g+=1;const m=(a[u>>>24]<<24|a[p>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^s[g];g+=1;const v=(a[p>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^s[g];g+=1,c[t]=y,c[t+1]=f,c[t+2]=m,c[t+3]=v}}os.keySize=8;const rs=Ke._createHelper(os),as=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],cs=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],ls=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],ds=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],hs=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679];function us(e,t){const s=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=s,this._lBlock^=s<<e}function ps(e,t){const s=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=s,this._rBlock^=s<<e}class gs extends Ke{_doReset(){const e=this._key.words,t=[];for(let s=0;s<56;s+=1){const i=as[s]-1;t[s]=e[i>>>5]>>>31-i%32&1}this._subKeys=[];const s=this._subKeys;for(let e=0;e<16;e+=1){s[e]=[];const i=s[e],n=ls[e];for(let e=0;e<24;e+=1)i[e/6|0]|=t[(cs[e]-1+n)%28]<<31-e%6,i[4+(e/6|0)]|=t[28+(cs[e+24]-1+n)%28]<<31-e%6;i[0]=i[0]<<1|i[0]>>>31;for(let e=1;e<7;e+=1)i[e]>>>=4*(e-1)+3;i[7]=i[7]<<5|i[7]>>>27}this._invSubKeys=[];const i=this._invSubKeys;for(let e=0;e<16;e+=1)i[e]=s[15-e]}encryptBlock(e,t){this._doCryptBlock(e,t,this._subKeys)}decryptBlock(e,t){this._doCryptBlock(e,t,this._invSubKeys)}_doCryptBlock(e,t,s){const i=e;this._lBlock=e[t],this._rBlock=e[t+1],us.call(this,4,252645135),us.call(this,16,65535),ps.call(this,2,858993459),ps.call(this,8,16711935),us.call(this,1,1431655765);for(let e=0;e<16;e+=1){const t=s[e],i=this._lBlock,n=this._rBlock;let o=0;for(let e=0;e<8;e+=1)o|=ds[e][((n^t[e])&hs[e])>>>0];this._lBlock=n,this._rBlock=i^o}const n=this._lBlock;this._lBlock=this._rBlock,this._rBlock=n,us.call(this,1,1431655765),ps.call(this,8,16711935),ps.call(this,2,858993459),us.call(this,16,65535),us.call(this,4,252645135),i[t]=this._lBlock,i[t+1]=this._rBlock}}gs.keySize=2,gs.ivSize=2,gs.blockSize=2;const ys=Ke._createHelper(gs);class fs extends Ke{_doReset(){const e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");const t=e.slice(0,2),s=e.length<4?e.slice(0,2):e.slice(2,4),i=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=gs.createEncryptor(ue.create(t)),this._des2=gs.createEncryptor(ue.create(s)),this._des3=gs.createEncryptor(ue.create(i))}encryptBlock(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)}decryptBlock(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)}}fs.keySize=6,fs.ivSize=2,fs.blockSize=2;const ms=Ke._createHelper(fs),vs=[],ws=[],bs=[];function ks(){const e=this._X,t=this._C;for(let e=0;e<8;e+=1)ws[e]=t[e];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<ws[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<ws[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<ws[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<ws[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<ws[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<ws[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<ws[6]>>>0?1:0)|0,this._b=t[7]>>>0<ws[7]>>>0?1:0;for(let s=0;s<8;s+=1){const i=e[s]+t[s],n=65535&i,o=i>>>16,r=((n*n>>>17)+n*o>>>15)+o*o,a=((4294901760&i)*i|0)+((65535&i)*i|0);bs[s]=r^a}e[0]=bs[0]+(bs[7]<<16|bs[7]>>>16)+(bs[6]<<16|bs[6]>>>16)|0,e[1]=bs[1]+(bs[0]<<8|bs[0]>>>24)+bs[7]|0,e[2]=bs[2]+(bs[1]<<16|bs[1]>>>16)+(bs[0]<<16|bs[0]>>>16)|0,e[3]=bs[3]+(bs[2]<<8|bs[2]>>>24)+bs[1]|0,e[4]=bs[4]+(bs[3]<<16|bs[3]>>>16)+(bs[2]<<16|bs[2]>>>16)|0,e[5]=bs[5]+(bs[4]<<8|bs[4]>>>24)+bs[3]|0,e[6]=bs[6]+(bs[5]<<16|bs[5]>>>16)+(bs[4]<<16|bs[4]>>>16)|0,e[7]=bs[7]+(bs[6]<<8|bs[6]>>>24)+bs[5]|0}class Es extends Oe{constructor(...e){super(...e),this.blockSize=4,this.ivSize=2}_doReset(){const e=this._key.words,{iv:t}=this.cfg;for(let t=0;t<4;t+=1)e[t]=16711935&(e[t]<<8|e[t]>>>24)|4278255360&(e[t]<<24|e[t]>>>8);this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16];const s=this._X;this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];const i=this._C;this._b=0;for(let e=0;e<4;e+=1)ks.call(this);for(let e=0;e<8;e+=1)i[e]^=s[e+4&7];if(t){const e=t.words,s=e[0],n=e[1],o=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),a=o>>>16|4294901760&r,c=r<<16|65535&o;i[0]^=o,i[1]^=a,i[2]^=r,i[3]^=c,i[4]^=o,i[5]^=a,i[6]^=r,i[7]^=c;for(let e=0;e<4;e+=1)ks.call(this)}}_doProcessBlock(e,t){const s=e,i=this._X;ks.call(this),vs[0]=i[0]^i[5]>>>16^i[3]<<16,vs[1]=i[2]^i[7]>>>16^i[5]<<16,vs[2]=i[4]^i[1]>>>16^i[7]<<16,vs[3]=i[6]^i[3]>>>16^i[1]<<16;for(let e=0;e<4;e+=1)vs[e]=16711935&(vs[e]<<8|vs[e]>>>24)|4278255360&(vs[e]<<24|vs[e]>>>8),s[t+e]^=vs[e]}}const As=Oe._createHelper(Es),Ss=[],Cs=[],Ds=[];function Is(){const e=this._X,t=this._C;for(let e=0;e<8;e+=1)Cs[e]=t[e];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<Cs[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<Cs[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<Cs[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<Cs[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<Cs[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<Cs[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<Cs[6]>>>0?1:0)|0,this._b=t[7]>>>0<Cs[7]>>>0?1:0;for(let s=0;s<8;s+=1){const i=e[s]+t[s],n=65535&i,o=i>>>16,r=((n*n>>>17)+n*o>>>15)+o*o,a=((4294901760&i)*i|0)+((65535&i)*i|0);Ds[s]=r^a}e[0]=Ds[0]+(Ds[7]<<16|Ds[7]>>>16)+(Ds[6]<<16|Ds[6]>>>16)|0,e[1]=Ds[1]+(Ds[0]<<8|Ds[0]>>>24)+Ds[7]|0,e[2]=Ds[2]+(Ds[1]<<16|Ds[1]>>>16)+(Ds[0]<<16|Ds[0]>>>16)|0,e[3]=Ds[3]+(Ds[2]<<8|Ds[2]>>>24)+Ds[1]|0,e[4]=Ds[4]+(Ds[3]<<16|Ds[3]>>>16)+(Ds[2]<<16|Ds[2]>>>16)|0,e[5]=Ds[5]+(Ds[4]<<8|Ds[4]>>>24)+Ds[3]|0,e[6]=Ds[6]+(Ds[5]<<16|Ds[5]>>>16)+(Ds[4]<<16|Ds[4]>>>16)|0,e[7]=Ds[7]+(Ds[6]<<8|Ds[6]>>>24)+Ds[5]|0}class _s extends Oe{constructor(...e){super(...e),this.blockSize=4,this.ivSize=2}_doReset(){const e=this._key.words,{iv:t}=this.cfg;this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16];const s=this._X;this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];const i=this._C;this._b=0;for(let e=0;e<4;e+=1)Is.call(this);for(let e=0;e<8;e+=1)i[e]^=s[e+4&7];if(t){const e=t.words,s=e[0],n=e[1],o=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),r=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),a=o>>>16|4294901760&r,c=r<<16|65535&o;i[0]^=o,i[1]^=a,i[2]^=r,i[3]^=c,i[4]^=o,i[5]^=a,i[6]^=r,i[7]^=c;for(let e=0;e<4;e+=1)Is.call(this)}}_doProcessBlock(e,t){const s=e,i=this._X;Is.call(this),Ss[0]=i[0]^i[5]>>>16^i[3]<<16,Ss[1]=i[2]^i[7]>>>16^i[5]<<16,Ss[2]=i[4]^i[1]>>>16^i[7]<<16,Ss[3]=i[6]^i[3]>>>16^i[1]<<16;for(let e=0;e<4;e+=1)Ss[e]=16711935&(Ss[e]<<8|Ss[e]>>>24)|4278255360&(Ss[e]<<24|Ss[e]>>>8),s[t+e]^=Ss[e]}}const Ms=Oe._createHelper(_s);function xs(){const e=this._S;let t=this._i,s=this._j,i=0;for(let n=0;n<4;n+=1){t=(t+1)%256,s=(s+e[t])%256;const o=e[t];e[t]=e[s],e[s]=o,i|=e[(e[t]+e[s])%256]<<24-8*n}return this._i=t,this._j=s,i}class $s extends Oe{_doReset(){const e=this._key,t=e.words,s=e.sigBytes;this._S=[];const i=this._S;for(let e=0;e<256;e+=1)i[e]=e;for(let e=0,n=0;e<256;e+=1){const o=e%s,r=t[o>>>2]>>>24-o%4*8&255;n=(n+i[e]+r)%256;const a=i[e];i[e]=i[n],i[n]=a}this._j=0,this._i=this._j}_doProcessBlock(e,t){e[t]^=xs.call(this)}}$s.keySize=8,$s.ivSize=0;const Bs=Oe._createHelper($s);class Os extends $s{constructor(...e){super(...e),Object.assign(this.cfg,{drop:192})}_doReset(){super._doReset.call(this);for(let e=this.cfg.drop;e>0;e-=1)xs.call(this)}}const Ts=Oe._createHelper(Os);function Ps(e,t,s,i){const n=e;let o;const r=this._iv;r?(o=r.slice(0),this._iv=void 0):o=this._prevBlock,i.encryptBlock(o,0);for(let e=0;e<s;e+=1)n[t+e]^=o[e]}class Us extends Te{}Us.Encryptor=class extends Us{processBlock(e,t){const s=this._cipher,{blockSize:i}=s;Ps.call(this,e,t,i,s),this._prevBlock=e.slice(t,t+i)}},Us.Decryptor=class extends Us{processBlock(e,t){const s=this._cipher,{blockSize:i}=s,n=e.slice(t,t+i);Ps.call(this,e,t,i,s),this._prevBlock=n}};class Ls extends Te{}Ls.Encryptor=class extends Ls{processBlock(e,t){const s=e,i=this._cipher,{blockSize:n}=i,o=this._iv;let r=this._counter;o&&(this._counter=o.slice(0),r=this._counter,this._iv=void 0);const a=r.slice(0);i.encryptBlock(a,0),r[n-1]=r[n-1]+1|0;for(let e=0;e<n;e+=1)s[t+e]^=a[e]}},Ls.Decryptor=Ls.Encryptor;const Ks=e=>{let t=e;if(255==(e>>24&255)){let s=e>>16&255,i=e>>8&255,n=255&e;255===s?(s=0,255===i?(i=0,255===n?n=0:n+=1):i+=1):s+=1,t=0,t+=s<<16,t+=i<<8,t+=n}else t+=1<<24;return t};
/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */
class js extends Te{}js.Encryptor=class extends js{processBlock(e,t){const s=e,i=this._cipher,{blockSize:n}=i,o=this._iv;let r=this._counter;o&&(this._counter=o.slice(0),r=this._counter,this._iv=void 0),(e=>{const t=e;t[0]=Ks(t[0]),0===t[0]&&(t[1]=Ks(t[1]))})(r);const a=r.slice(0);i.encryptBlock(a,0);for(let e=0;e<n;e+=1)s[t+e]^=a[e]}},js.Decryptor=js.Encryptor;class Hs extends Te{}Hs.Encryptor=class extends Hs{processBlock(e,t){this._cipher.encryptBlock(e,t)}},Hs.Decryptor=class extends Hs{processBlock(e,t){this._cipher.decryptBlock(e,t)}};class Ns extends Te{}Ns.Encryptor=class extends Ns{processBlock(e,t){const s=e,i=this._cipher,{blockSize:n}=i,o=this._iv;let r=this._keystream;o&&(this._keystream=o.slice(0),r=this._keystream,this._iv=void 0),i.encryptBlock(r,0);for(let e=0;e<n;e+=1)s[t+e]^=r[e]}},Ns.Decryptor=Ns.Encryptor;const Gs={pad(e,t){const s=4*t,i=s-e.sigBytes%s;e.concat(ue.random(i-1)).concat(ue.create([i<<24],1))},unpad(e){const t=e,s=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=s}},Rs={pad(e,t){const s=e,i=4*t;s.clamp(),s.sigBytes+=i-(e.sigBytes%i||i)},unpad(e){const t=e,s=t.words;for(let e=t.sigBytes-1;e>=0;e-=1)if(s[e>>>2]>>>24-e%4*8&255){t.sigBytes=e+1;break}}},zs={pad(e,t){e.concat(ue.create([2147483648],1)),Rs.pad(e,t)},unpad(e){const t=e;Rs.unpad(t),t.sigBytes-=1}},Fs={stringify:e=>e.ciphertext.toString(pe),parse(e){const t=pe.parse(e);return je.create({ciphertext:t})}};var qs={lib:{Base:he,WordArray:ue,BufferedBlockAlgorithm:fe,Hasher:me,Cipher:Be,StreamCipher:Oe,BlockCipherMode:Te,BlockCipher:Ke,CipherParams:je,SerializableCipher:Ne,PasswordBasedCipher:Re},x64:{Word:be,WordArray:ke},enc:{Hex:pe,Latin1:ge,Utf8:ye,Utf16:qe,Utf16BE:Fe,Utf16LE:We,Base64:Ee},algo:{HMAC:ve,MD5:_e,SHA1:Xe,SHA224:ct,SHA256:ot,SHA384:ft,SHA512:pt,SHA3:Dt,RIPEMD160:Nt,PBKDF2:zt,EvpKDF:$e,AES:os,DES:gs,TripleDES:fs,Rabbit:Es,RabbitLegacy:_s,RC4:$s,RC4Drop:Os},mode:{CBC:Ue,CFB:Us,CTR:Ls,CTRGladman:js,ECB:Hs,OFB:Ns},pad:{Pkcs7:Le,AnsiX923:{pad(e,t){const s=e,i=s.sigBytes,n=4*t,o=n-i%n,r=i+o-1;s.clamp(),s.words[r>>>2]|=o<<24-r%4*8,s.sigBytes+=o},unpad(e){const t=e,s=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=s}},Iso10126:Gs,Iso97971:zs,NoPadding:{pad(){},unpad(){}},ZeroPadding:Rs},format:{OpenSSL:He,Hex:Fs},kdf:{OpenSSL:Ge},MD5:Me,HmacMD5:xe,SHA1:Ye,HmacSHA1:Je,SHA224:lt,HmacSHA224:dt,SHA256:rt,HmacSHA256:at,SHA384:mt,HmacSHA384:vt,SHA512:gt,HmacSHA512:yt,SHA3:It,HmacSHA3:_t,RIPEMD160:Gt,HmacRIPEMD160:Rt,PBKDF2:(e,t,s)=>zt.create(s).compute(e,t),EvpKDF:(e,t,s)=>$e.create(s).compute(e,t),AES:rs,DES:ys,TripleDES:ms,Rabbit:As,RabbitLegacy:Ms,RC4:Bs,RC4Drop:Ts};const Ws=["Aquatic","Aesthetical","Ageless","Authentic","Afraid","Athletic","Academic","Adventurous","Aromatic","Advantageous","Bad","Bald","Beautiful","Bitter","Barking","Baffling","Bankrupt","Busy","Burning","Boring","Bold","Charming","Cheerful","Clean","Curly","Curious","Caring","Crazy","Cute","Careful","Classy","Cheap","Clingy","Classic","Chunky","Cuddly","Clumsy","Cold","Cozy","Creamy","Cosmetic","Cryptic","Cynical","Damaged","Dandy","Dazzling","Dark","Deadly","Dangerous","Decent","Deep","Dirty","Dramatic","Dull","Delightful","Delicious","Discreet","Dizzy","Disrespectful","Eager","Early","Elegant","Energetic","Easy","Euphoric","Exotic","Economic","Eccentric","Efficient","Educated","Elderly","Egotistical","Elite","Empty","Eternal","Enthusiastic","Enormous","Expensive","Exuberant","Eye-Popping","Fancy","Fantastic","Fierce","Foolish","Funny","Fascinating","Fatal","Flawless","Foolish","Fat","Fictional","Flat","Flying","French","Fuzzy","Furious","Frozen","Fruity","Generic","Gentle","Gifted","Glamorous","Gleaming","Glorious","Gorgeous","Grateful","Gross","Grim","Grimy","Giant","Goofy","Gooey","Great","Giggly","Giving","Gigantic","Gruesome","Great","Groovy","Hairy","Handsome","Happy","Harsh","Hateful","Haunting","Hairless","Hard","Heartless","Heavy","Hip","Hollow","Helpless","Horrible","Hot","Huge","Humble","Hungry","Humble","Hypnotic","Hypersensitive","Hysterical","Hyperactive","Helpful","Honest","Hurtful","Icy","Idiotic","Immature","Impolite","Impressive","Incredible","Innocent","Immortal","Imaginary","Imaginative","Indirect","Insane","Insignificant","Intense","Intimidating","Interesting","Irritating","Isolated","Italian","Irresistible","Irrelevant"],Qs=["Alligator","Alpaca","Anaconda","Ape","Axolotl","Albatross","Ant","Antelope","Barracuda","Bumblebee","Buffalo","Baboon","Bird","Bee","Butterfly","Cat","Chameleon","Cockatoo","Cheetah","Chicken","Coyote","Cow","Crab","Duck","Dalmatian","Dolphin","Dog","Dingo","Dachshund","Dodo","Deer","Dragonfish","Eagle","Elephant","Emu","Elk","Earthworm","Eel","Echidna","Frog","Flamingo","Falcon","Firefly","Fox","Fish","Ferret","Giraffe","Gorilla","Gnu","Gazelle","Goldfish","Gopher","Gecko","Gnat","Gibbon","Goat","Goose","Grasshoper","Grouse","Guppy","Hamster","Hornbill","Hedgehog","Hippo","Horse","Honeybee","Husky","Hyena","Hummingbird","Iguana","Impala"],Xs=Object.freeze({fadeLeftOut:function(){return"animation: fadeLeftOutAnimation 0.3s !important;"},fadeLeftIn:function(){return"animation: fadeLeftInAnimation 0.3s !important;"},fadeRightOut:function(){return"animation: fadeRightOutAnimation 0.3s !important;"},fadeRightIn:function(){return"animation: fadeRightInAnimation 0.3s !important;"}});function Ys(e){const t=e.which?e.which:e.keyCode;return 0===e.target.selectionStart&&35===t||!(t>31&&(t<48||t>57))}function Js(e){const t=new Date(e);return`${t.toDateString()} ${t.toLocaleTimeString()}`}function Vs(e,t,s){t.style=Xs.fadeRightOut(),setTimeout((()=>{t.classList.add("hide"),e.classList.remove("hide"),t.style="",e.style=Xs.fadeLeftIn(),requestAnimationFrame((()=>{s?.focus(),e.style=""}))}),300)}function Zs(e,t,s){e.style=Xs.fadeLeftOut(),setTimeout((()=>{e.classList.add("hide"),t.classList.remove("hide"),e.style="",t.style=Xs.fadeRightIn(),requestAnimationFrame((()=>{s?.focus(),t.style=""}))}),300)}function ei(){const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!?";return[...new Array(32)].map((function(){return e[(t=0,s=e.length-1,Math.floor(Math.random()*(s-t+1)+t))];var t,s})).join("")}function ti(){const e=ei(),t=Date.now()+"",s=qs.AES.encrypt(e,t).toString();return Object.freeze({password:s,salt:t})}function si(e,t){const s=new URL(window.location.href),i=qs.AES.encrypt(t,"hamburgerANDpizza0987654e3").toString();return`${s.origin}?${e}=${encodeURIComponent(i)}`}function ii(e){return decodeURIComponent(qs.AES.decrypt(e,"hamburgerANDpizza0987654e3").toString(qs.enc.Utf8))}function ni(){const e=window.navigator.standalone;function t(e,t){const s=`${window.innerHeight}px`;e.style.height=re?"fit-content":s,t.style.height=s}if(oe){const s=document.querySelector("messages-menu"),i=document.querySelector("app-layout"),n=document.querySelector(".write-message-input");e||t(s,i),n.onfocus=function(){setTimeout((()=>(function(e,t){const s=`${window.innerHeight}px`;re?(e.style.height=s,t.style.height=s):e.style.height="-webkit-fill-available"}(s,i),window.scrollTo(0,0),s.scrollToBottom())),350)},n.onblur=function(){setTimeout((()=>t(s,i)),350)}}}customElements.define("invite-modal-window",class extends Z{static properties={inviteURL:{type:String},ME:{type:Object}};constructor(){super(),this.ME=de,this.isGenerated=!1}createRenderRoot(){return this}open(){const e=new CustomEvent("inviteGenerated",{bubbles:!1,detail:{type:"user",sentInviteLink:!0}}),t=this.querySelector(".qr");return super.open(),navigator.clipboard.writeText(this.url).then((()=>{t.focus()})),t.innerHTML="",new QRCode(t,{text:this.url}),ce.app.dispatchEvent(e)}render(){const e=si("user",this.ME.id),t=$`<p class="create-group-headline">Invite Friends to be8</p><p>${ne(le.INVITELINK.replaceAll("{{link}}",this.url))}</p><br><div class="qr"></div><br>`;return this.url=e,super.render(t)}});
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const{H:oi}=W,ri=()=>document.createComment(""),ai=(e,t,s)=>{var i;const n=e._$AA.parentNode,o=void 0===t?e._$AB:t._$AA;if(void 0===s){const t=n.insertBefore(ri(),o),i=n.insertBefore(ri(),o);s=new oi(t,i,e,e.options)}else{const t=s._$AB.nextSibling,r=s._$AM,a=r!==e;if(a){let t;null===(i=s._$AQ)||void 0===i||i.call(s,e),s._$AM=e,void 0!==s._$AP&&(t=e._$AU)!==r._$AU&&s._$AP(t)}if(t!==o||a){let e=s._$AA;for(;e!==t;){const t=e.nextSibling;n.insertBefore(e,o),e=t}}}return s},ci=(e,t,s=e)=>(e._$AI(t,s),e),li={},di=e=>{var t;null===(t=e._$AP)||void 0===t||t.call(e,!1,!0);let s=e._$AA;const i=e._$AB.nextSibling;for(;s!==i;){const e=s.nextSibling;s.remove(),s=e}},hi=(e,t,s)=>{const i=new Map;for(let n=t;n<=s;n++)i.set(e[n],n);return i},ui=te(class extends se{constructor(e){if(super(e),e.type!==ee)throw Error("repeat() can only be used in text expressions")}ht(e,t,s){let i;void 0===s?s=t:void 0!==t&&(i=t);const n=[],o=[];let r=0;for(const t of e)n[r]=i?i(t,r):r,o[r]=s(t,r),r++;return{values:o,keys:n}}render(e,t,s){return this.ht(e,t,s).values}update(e,[t,s,i]){var n;const o=(e=>e._$AH)(e),{values:r,keys:a}=this.ht(t,s,i);if(!Array.isArray(o))return this.ut=a,r;const c=null!==(n=this.ut)&&void 0!==n?n:this.ut=[],l=[];let d,h,u=0,p=o.length-1,g=0,y=r.length-1;for(;u<=p&&g<=y;)if(null===o[u])u++;else if(null===o[p])p--;else if(c[u]===a[g])l[g]=ci(o[u],r[g]),u++,g++;else if(c[p]===a[y])l[y]=ci(o[p],r[y]),p--,y--;else if(c[u]===a[y])l[y]=ci(o[u],r[y]),ai(e,l[y+1],o[u]),u++,y--;else if(c[p]===a[g])l[g]=ci(o[p],r[g]),ai(e,o[u],o[p]),p--,g++;else if(void 0===d&&(d=hi(a,g,y),h=hi(c,u,p)),d.has(c[u]))if(d.has(c[p])){const t=h.get(a[g]),s=void 0!==t?o[t]:null;if(null===s){const t=ai(e,o[u]);ci(t,r[g]),l[g]=t}else l[g]=ci(s,r[g]),ai(e,o[u],s),o[t]=null;g++}else di(o[p]),p--;else di(o[u]),u++;for(;g<=y;){const t=ai(e,l[y+1]);ci(t,r[g]),l[g++]=t}for(;u<=p;){const e=o[u++];null!==e&&di(e)}return this.ut=a,((e,t=li)=>{e._$AH=t})(e,l),B}});
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */customElements.define("status-modal-window",class extends Z{static properties={status:{type:Array},groupMembers:{type:Array},type:{type:String},ME:{type:Object}};constructor(){super(),this.isGroup=!1,this.status=[],this.groupMembers=[]}createRenderRoot(){return this}#c(){const e=this.groupMembers.filter((e=>e.id!==this.ME.id)),t=e.filter((e=>!this.status.find((t=>t===e.id)))),s=e.filter((e=>this.status.find((t=>t===e.id)))),i=e=>$`<li><span class="group-color-${e.color}">${e.memberIcon} ${e.nickname} #${e.id}</span></li>`,n=ui(t,(e=>e.id),i),o=ui(s,(e=>e.id),i);return $`<div class="read-container"><h2>Read <i class="fa-solid fa-check read-check float-right"><i class="fa-solid fa-check read-check float-right"></i></i></h2><ul>${o}</ul></div><div><h2>Not read <i class="fa-solid fa-check sent-check float-right"></i></h2><ul>${n}</ul></div>`}render(){return"group"===this.type?super.render(this.#c()):super.render("groups only")}});customElements.define("panic-modal-window",class extends Z{static properties={ME:{type:Object}};constructor(){super(),this.ME=de}createRenderRoot(){return this}onKeyPress(e){return Ys(e)?"Enter"===e.key?this.onClickDestroy():void 0:(e.preventDefault(),e.stopPropagation(),!1)}onClickDestroy(){if(this.querySelector("input").value.trim()===this.ME.id){const e=new CustomEvent("panic",{bubbles:!1,detail:{...this.ME,done:async()=>location.reload()}});return ce.app.dispatchEvent(e)}return ce.toast.notification={type:"error",text:"Wrong code"},ce.toast.open()}open(){super.open(),requestAnimationFrame((()=>this.querySelector("input").focus()))}render(){const e=ne(le.PANICTEXT.replaceAll("{{id}}",this.ME.id)),t=$`<p>${e}</p><div><input tabindex="0" @keydown="${e=>this.onKeyPress(e)}" type="number" min="0"></div><button @click="${this.onClickDestroy}" class="danger-background">destroy everything</button>`;return super.render(t)}});function pi(){ce.toast.notification={type:"success",text:"Your unlock code and destroy code are set. Auto refresh in 2s."},ce.toast.open(),setTimeout((()=>location.reload()),1750)}customElements.define("conversation-modal-window",class extends Z{static properties={ME:{}};#l={};#d={};#h={};#u={};#p={};constructor(){super(),this.ME={}}createRenderRoot(){return this}open(){super.open(),requestAnimationFrame((()=>this.#h.focus()))}#g(){Zs(this.#l,this.#d,this.#u)}#y(){Vs(this.#l,this.#d,this.#h)}#f(e,t){const s=new CustomEvent("createGroup",{bubbles:!1,detail:{...this.ME,nickname:e,groupType:t,success:()=>(ce.toast.notification={type:"success",text:"You created the group "+e},this.#u.value="",ce.toast.open(),this.close())}});return ce.app.dispatchEvent(s)}#m(){const e=this.#u.value.trim(),t=this.#p.value;return 0===e.length?(ce.toast.notification={type:"error",text:"Enter a valid name for your group"},ce.toast.open()):this.#f(e,t)}close(){super.close(),this.#y()}#v(e){const t=new CustomEvent("startConversation",{bubbles:!1,detail:{...this.ME,receiverID:e,success:()=>(ce.toast.notification={type:"success",text:"Your are now chatting with "+e},this.#h.value="",ce.toast.open(),this.close()),idDoesNotExist:()=>{ce.toast.notification={type:"error",text:"This id does not exist or banned you "+e},ce.toast.open()}}});return ce.app.dispatchEvent(t)}#w(e){if(13===e.keyCode)return this.#m()}#b(e){if(!Ys(e))return e.preventDefault(),e.stopPropagation(),!1;if(13===e.keyCode){const e=this.#h.value.trim();return 0===e.length?(ce.toast.notification={type:"error",text:"Enter a be8 id"},ce.toast.open()):e===this.ME.id?(ce.toast.notification={type:"error",text:"You can not chat with yourself."},ce.toast.open()):this.#v(e)}}firstUpdated(){this.#l=this.querySelector(".modal-content"),this.#d=this.querySelector(".create-group-content"),this.#h=this.#l.querySelector("input"),this.#u=this.#d.querySelector("input"),this.#p=this.#d.querySelector("select")}render(){const e=$`<p>${le.CONVERSATION}</p><input @keydown="${e=>this.#b(e)}" tabindex="0" type="number" min="0"><div @click="${this.#g}" class="sub-modal-button hover-background">Create a group <i class="fa-solid fa-arrow-right float-right"></i></div>`,t=$`<div><p>Name</p><input @keydown="${e=>this.#w(e)}" type="text" maxlength="20"></div><p>Type</p><select><option value="public">public</option><option value="private">private</option></select><button @click="${this.#m}">create group</button>`,s=$`<div class="create-group-content hide"><p class="create-group-headline"><i @click="${this.#y}" class="fa-solid fa-arrow-left hover-font float-left"></i> <span>Create a group</span></p>${t}</div>`;return super.render(e,s)}});customElements.define("codes-modal-window",class extends Z{static properties={ME:{type:Object},state:{type:String}};#l={};#k={};#E={};constructor(){super(),this.ME=de}clickOnUpdateUnlock(){const[e,t,s]=[...this.#k.querySelectorAll("input")],i=t.value,n=s.value,o=e.value,r=new CustomEvent("updateCode",{bubbles:!1,detail:{...this.ME,code:i,oldCode:o,codeType:"unlock",done:()=>(pi(),this.close()),oldCodeWrong:()=>(ce.toast.notification={type:"error",text:"Your old code is wrong."},ce.toast.open())}});return i!==n?(ce.toast.notification={type:"error",text:"Your new code and your re-typed are not identical."},ce.toast.open()):ce.app.dispatchEvent(r)}clickOnUpdateDestroy(){const[e,t,s]=[...this.#E.querySelectorAll("input")],i=t.value,n=s.value,o=e.value,r=new CustomEvent("updateCode",{bubbles:!1,detail:{...this.ME,code:i,oldCode:o,codeType:"destroy",done:()=>(pi(),this.close()),oldCodeWrong:()=>(ce.toast.notification={type:"error",text:"Your old code is wrong."},ce.toast.open())}});return i!==n?(ce.toast.notification={type:"error",text:"Your new code and your re-typed are not identical."},ce.toast.open()):ce.app.dispatchEvent(r)}goToUpdateUnlock(){const e=this.#k.querySelector("input");this.state="unlock",Zs(this.#l,this.#k,e)}goToUpdateDestroy(){const e=this.#k.querySelector("input");this.state="destroy",Zs(this.#l,this.#E,e)}backToUpdateSelect(){"unlock"===this.state&&Vs(this.#l,this.#k),"destroy"===this.state&&Vs(this.#l,this.#E),this.state="main"}open(){super.open(),this.state="main",requestAnimationFrame((()=>this.querySelector("input")?.focus())),this.#k=this.querySelector(".unlock-side"),this.#E=this.querySelector(".destroy-side")}close(){super.close(),this.backToUpdateSelect()}setup(){const e=[...this.querySelectorAll("input")],[t,s,i,n]=e,o=t.value,r=s.value,a=i.value,c=n.value,l=o===r,d=a===c,h=new CustomEvent("setupCodes",{bubbles:!1,detail:{...this.ME,unlockCode:o,destroyCode:a,done:()=>{pi(),e.forEach((e=>e.value="")),this.close()}}});return l?d?o===a?(ce.toast.notification={type:"error",text:"Destroy and unlock are the same code"},ce.toast.open()):0===o.length||0===r.length?(ce.toast.notification={type:"error",text:"You have to enter an unlock code"},ce.toast.open()):0===a.length||0===c.length?(ce.toast.notification={type:"error",text:"You have to enter a destroy code"},ce.toast.open()):ce.app.dispatchEvent(h):(ce.toast.notification={type:"error",text:"Destroy and destroy re-type are not equal"},ce.toast.open()):(ce.toast.notification={type:"error",text:"Unlock and unlock re-type are not equal"},ce.toast.open())}onKeyPress(e){if("Enter"===e.key)return this.setup()}renderUpdateSide(){const e=$`<div class="unlock-side hide"><p class="create-group-headline"><i @click="${this.backToUpdateSelect}" class="fa-solid fa-arrow-left hover-font float-left"></i> <span>Update Unlock</span></p><small>Old Code</small><input autocomplete="off" type="password" maxlength="40"><small>New Code</small><input type="password" maxlength="40"> <small>New Code re-type</small><input type="password" maxlength="40"><button @click="${this.clickOnUpdateUnlock}" class="full-width">Update</button></div>`,t=$`<div class="destroy-side hide"><p class="create-group-headline"><i @click="${this.backToUpdateSelect}" class="fa-solid fa-arrow-left hover-font float-left"></i> <span>Update Destroy</span></p><small>Old Code</small><input autocomplete="off" type="password" maxlength="40"><small>New Code</small><input type="password" maxlength="40"> <small>New Code re-type</small><input type="password" maxlength="40"><button @click="${this.clickOnUpdateDestroy}" class="full-width">Update</button></div>`;return $`${e}${t}`}renderUpdate(){const e=$`<p @click="${this.goToUpdateUnlock}" class="sub-modal-button hover-background"><span>Unlock Code</span> <i class="fa-solid fa-arrow-right hover-font float-right"></i></p>`,t=$`<p @click="${this.goToUpdateDestroy}" class="sub-modal-button hover-background"><span>Destroy Code</span> <i class="fa-solid fa-arrow-right hover-font float-right"></i></p>`;return $`<p class="create-group-headline">Update</p>${e}${t}`}renderSetup(){const e=$`<div class="setup-unlock-container"><p class="create-group-headline">Setup</p><small>${le.UNLOCKSETUPTEXT}</small></div>`,t=$`<form class="setup-unlock-container"><p>Unlock Code</p><small>new password</small><input type="password" autocomplete="off" maxlength="40"><small>re-type</small><input type="password" autocomplete="off" maxlength="40"></form>`,s=$`<form><p>Destroy Code</p><small>new destory code</small><input type="password" autocomplete="off" maxlength="40"><small>re-type</small><input type="password" autocomplete="off" maxlength="40" @keydown="${e=>this.onKeyPress(e)}"></form>`;return $`${e}${t}${s}<button @click="${this.setup}" class="full-width">Setup</button>`}firstUpdated(){this.#l=this.querySelector(".modal-content")}render(){const e=this.ME.codes?this.renderUpdate():this.renderSetup(),t=this.ME.codes?this.renderUpdateSide():"";return super.render(e,t)}});customElements.define("lock-modal-window",class extends Z{static properties={ME:{type:Object}};#A=function(){};#S={};constructor(){super(!1),this.ME={}}createRenderRoot(){return this}enterUnlockCode(e){if(13===e.keyCode){const e=new CustomEvent("unlock",{detail:{code:this.#S.value,done:()=>(ce.toast.notification={type:"success",text:"be8 unlocked"},ce.toast.open(),this.#A(),this.close()),error:()=>(ce.toast.notification={type:"error",text:"wrong unlock code"},ce.toast.open())}});return ce.app.dispatchEvent(e)}}open(e=function(){}){return this.ME.codes?(this.#A=e,super.open(),requestAnimationFrame((()=>this.#S.focus())),!0):(e(),!1)}firstUpdated(){this.#S=this.querySelector("input")}render(){const e=$`<p class="create-group-headline">Unlock be8</p><small>Enter your unlock code to use be8</small><input type="password" autocomplete="off" @keydown="${e=>this.enterUnlockCode(e)}" maxlength="40">`;return super.render(e)}});const gi=Object.freeze({system:"comment-dots",user:"user",group:"users-rectangle",channel:"object-ungroup"}),yi=Object.freeze({admin:"screwdriver-wrench",moderator:"screwdriver",specialUser:"user-graduate",user:"user"}),fi=Object.freeze(["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]);customElements.define("user-modal-window",class extends Z{static properties={conversationPartner:{type:Object}};constructor(){super(),this.conversationPartner=le}render(){const e=Js(this.conversationPartner.expire),t=$`<i class="fa-solid fa-${gi.user}"></i>`,s=$`<p class="create-group-headline">${t} ${this.conversationPartner.nickname}</p>`,i=$`<p><span>ID:</span> <span>${this.conversationPartner.id}</span></p>`,n=$`<p><span>Nickname:</span> <span>${this.conversationPartner.nickname}</span></p>`,o=$`<p><span>Status:</span> <span>"${this.conversationPartner.userStatus}"</span></p>`,r=this.conversationPartner.endless?"":$`<p><span>Valid Account:</span> <span>${e}</span></p>`,a=this.conversationPartner.endless?$`<i class="fa-solid fa-check danger-color"></i>`:$`<i class="fa-solid fa-times"></i>`,c=$`<p><span>Endless Account: </span>${a}</p>`,l=$`${s}${i}${n}${r}${c}${o}`;return super.render(l)}});customElements.define("sysuser-modal-window",class extends Z{static properties={conversationPartner:{type:Object}};constructor(){super(),this.conversationPartner=le}render(){const e=$`<i class="fa-solid fa-${gi.system}"></i>`,t=$`<p class="create-group-headline">${e} ${this.conversationPartner.nickname}</p>`,s=$`${t}<p>This is a system user you can't send messages to the system user.</p>`;return super.render(s)}});customElements.define("groupuser-modal-window",class extends Z{static properties={ME:{type:Object},state:{type:String},conversationPartner:{type:Object},members:{type:Array},inviteUrl:{type:String}};#C={};#D={};#I={};#l={};#_={};constructor(){super(),this.conversationPartner=le,this.members=[]}#M(){this.state="addUser",Zs(this.#l,this.#D,this.#_)}#x(){const e=new CustomEvent("inviteGenerated",{detail:{sentInviteLink:!0,type:"group"}});return navigator.clipboard.writeText(this.inviteUrl).then((()=>{})),this.state="invite",Zs(this.#l,this.#C),ce.app.dispatchEvent(e)}#$(){this.state="leaveGroup",Zs(this.#l,this.#I)}open(){const e=this.querySelector(".qr");return e&&(e.innerHTML="",new QRCode(e,{text:this.inviteUrl})),super.open()}close(){super.close(),this.#y()}#y(){"invite"===this.state&&Vs(this.#l,this.#C),"leaveGroup"===this.state&&Vs(this.#l,this.#I),"addUser"===this.state&&Vs(this.#l,this.#D),this.state="main"}firstUpdated(){this.#C=this.querySelector(".invite-group-modal"),this.#D=this.querySelector(".adduser-group-modal"),this.#I=this.querySelector(".leave-group-modal"),this.#l=this.querySelector(".modal-content"),this.#_=this.querySelector(".adduser-group-modal input")}#B(e,t){const s=new CustomEvent("addGroupMember",{bubbles:!1,detail:{...this.conversationPartner,id:e,done:()=>(ce.toast.notification={type:"success",text:"You added "+e+" to your group"},t.value="",ce.toast.open(),this.close()),warning:e=>(ce.toast.notification={type:"warning",text:le[e]},ce.toast.open())}});return ce.app.dispatchEvent(s)}enterBe8Id(e){if(!Ys(e))return e.preventDefault(),e.stopPropagation(),!1;if("Enter"===e.key){const t=e.target.value.trim();return 0===t.length?(ce.toast.notification={type:"error",text:"Enter a be8 id"},ce.toast.open()):t===this.ME.id?(ce.toast.notification={type:"error",text:"You can not chat with yourself."},ce.toast.open()):this.#B(t,e.target)}}#O(){const e=new CustomEvent("leaveGroup",{bubbles:!1,detail:{...this.conversationPartner,...this.Me,done:()=>this.close()}});return ce.app.dispatchEvent(e)}#T(e){const t="private"===this.conversationPartner.groupType,s=t?"":$`<div class="sub-modal-button hover-background" @click="${this.#x}"><i class="fa-solid fa-person-circle-plus"></i> Invite User <i class="fa-solid fa-arrow-right float-right"></i></div>`,i=e||!t?$`<div @click="${this.#M}" class="sub-modal-button hover-background"><i class="fa-solid fa-plus"></i> Add Member <i class="fa-solid fa-arrow-right float-right"></i></div>`:"";return $`<div class="group-actions">${i}${s}<div class="sub-modal-button hover-background" @click="${this.#$}"><i class="fa-solid fa-person-through-window"></i> Leave Group <i class="fa-solid fa-arrow-right float-right"></i></div></div>`}#P(e){const t="private"===this.conversationPartner.groupType,s=si("group",this.conversationPartner.groupID),i=$`<i @click="${this.#y}" class="fa-solid fa-arrow-left float-left hover-font"></i>`,n=$`<div class="adduser-group-modal hide"><p class="create-group-headline">${i} Add new Member</p><small>Enter a valid be8 id.</small><input @keydown="${e=>this.enterBe8Id(e)}" type="number" min="0"></div>`,o=e?le.LEAVEGROUPADMIN:le.LEAVEGROUPMEMBER,r=$`<div class="leave-group-modal hide"><p class="create-group-headline">${i} Leave Group</p><small>${o}</small><div class="leave-group-settings"><button @click="${this.#O}" class="danger-background">Yes</button><button @click="${this.close}" class="hover-background">No</button></div></div>`,a=t?"":$`<div class="invite-group-modal hide"><p class="create-group-headline">${i} Invite Friends to your Group</p><p>${ne(le.INVITELINK.replaceAll("{{link}}",s))}</p><br><div class="qr"></div><br></div>`;return this.inviteUrl=s,$`${n}${a}${r}`}#U(e){const t=e.target.getAttribute("data-id"),s=new CustomEvent("kickMemberFromGroup",{bubbles:!1,detail:{...this.conversationPartner,accID:t,done:()=>(ce.toast.notification={type:"success",text:"You kicked "+t+" someone from your group"},ce.toast.open())}});return ce.app.dispatchEvent(s)}render(){const e="public"===this.conversationPartner.groupType?"orange-background":"danger-background",t=$`<p class="create-group-headline"><small class="group-type-badge ${e} float-left">${this.conversationPartner.groupType}</small> ${this.conversationPartner.nickname}</p>`,s=this.ME.id===this.conversationPartner.admin,i=this.#T(s),n=ui(this.members,(e=>e.id),(({nickname:e,id:t,expire:i,endless:n,type:o})=>{const r=n||"system"===o?$`<i class="fa-solid fa-check danger-color"></i>`:"",a=this.ME.id===t,c=s&&!a?$`<span data-id="${t}" @click="${this.#U}" class="float-right hover-font">kick</span>`:"",l=this.conversationPartner.admin===t,d=$`<i class="fa-solid fa-${yi[l?"admin":"user"]}"></i>`;return $`<div class="group-member hover-background">${d}<p class="member-firstline">${e} ${r}<span class="float-right">#${t}</span></p><p class="member-secondline">${Js(i)}${c}</p></div>`})),o=$`<p>Members: ${this.members.length} / ${this.conversationPartner.maxMembers}</p>`,r=$`${t}${o}<div class="group-members">${n}</div>${i}`,a=this.#P(s);return super.render(r,a)}});const mi=Object.freeze({WELCOME:'Welcome to Be8, your nickname is <i class="highlight-color">{{nickname}}</i>. Be8 is the first ever real privacy messenger. Everything is End-to-End encrypted, only your device knows your key! Everything gets deleted after 30 days even your account, but you can create as much accounts as you want. Your id is <i class="highlight-color">#{{id}}</i>. You can find your expire date on the top left. Have fun.',STARTCONVERSATION:'Start conversation with <i class="highlight-color">#{{conversationID}}</i>',CREATEDGROUP:'You created a new group with the id <i class="highlight-color">{{extra1}}</i> and name <i class="highlight-color">{{extra2}}</i>',ADDEDTOGROUP:'<i class="highlight-color">{{extra3}}</i> with id <i class="highlight-color">#{{extra1}}</i> added you to group {{extra2}}',ACCADDEDTOGROUP:'<i class="highlight-color">{{extra1}}</i> id <i class="highlight-color">#{{extra2}}</i> was added to the group.',ACCJOINEDGROUP:'<i class="highlight-color">{{extra2}}</i> with id <i class="highlight-color">#{{extra1}}</i> joined <i class="highlight-color">{{threadID}}</i>.',ACCDELETED:'Account <i class="highlight-color">#{{extra1}}</i> has been destroyed.',LEFTGROUP:'You left group <i class="highlight-color">{{extra2}}</i> with id <i class="highlight-color">#{{extra1}}</i>.',ACCLEFTGROUP:'<i class="highlight-color">{{extra2}}</i> with id <i class="highlight-color">#{{extra1}}</i> left <i class="highlight-color">{{threadID}}</i>.',KICKEDFROMGROUP:'You were kicked from group <i class="highlight-color">{{extra2}}</i> with id <i class="highlight-color">#{{extra1}}</i>',ACCKICKEDFROMGROUP:'<i class="highlight-color">{{extra2}}</i> with id <i class="highlight-color">#{{extra1}}</i> was kicked from <i class="highlight-color">{{threadID}}</i>.',GROUPDELETED:'Group <i class="highlight-color">{{extra2}}</i> with id <i class="highlight-color">#{{extra1}}</i> was deleted.'}),vi=Object.freeze({WELCOME:"Welcome to the Be8 messenger",STARTCONVERSATION:"A new conversation started",CREATEDGROUP:"You created a new group",ADDEDTOGROUP:"You were added to a group",ACCADDEDTOGROUP:"User was added to a group",ACCJOINEDGROUP:"Acc joined group",ACCDELETED:"Acc you know is destroyed",LEFTGROUP:"An user left the group",KICKEDFROMGROUP:"You were kicked from a group",ACCLEFTGROUP:"Acc left group",ACCKICKEDFROMGROUP:"User was kicked from group",GROUPDELETED:"Group was deleted",SENTIMAGE:" You sent an image",RECEIVEDIMAGE:" You received an image"});customElements.define("messages-menu",class extends J{static properties={conversationPartner:{type:Object},messages:{type:Array},ME:{type:Object}};#L=document.querySelector("user-modal-window");#K=document.querySelector("groupuser-modal-window");#j=document.querySelector("sysuser-modal-window");#H=document.querySelector("status-modal-window");#N={};#G={};constructor(){super(),this.conversationPartner={},this.messages=[]}createRenderRoot(){return this}clickOnBack(){ce.navi.classList.remove("hide"),ce.menus.messagesMenu.classList.add("hide"),ce.header.classList.remove("hide"),ce.bottomNavi.classList.remove("hide"),ce.bottomNavi.querySelector("div").classList.add("active-setting")}clickOnUser(){"user"===this.conversationPartner.type&&(this.#L.conversationPartner=this.conversationPartner,this.#L.open()),"group"===this.conversationPartner.type&&(this.#K.conversationPartner=this.conversationPartner,this.#K.open()),"system"===this.conversationPartner.type&&(this.#j.conversationPartner=this.conversationPartner,this.#j.open())}setActive({type:e}){const t="system"===e;this.#R(),this.setInput(),t?(this.#G.classList.contains("disabled")||(this.#G.classList.add("disabled"),this.#G.classList.remove("hover-font")),this.#N.disabled=!0):(this.#G.classList.contains("disabled")&&(this.#G.classList.remove("disabled"),this.#G.classList.add("hover-font")),this.#N.disabled=!1)}setInput(e=""){return this.#N.value=e}#R(){oe||requestAnimationFrame((()=>this.#N.focus()))}firstUpdated(){this.#N=this.querySelector(".write-message-input"),this.#G=document.querySelector(".fa-photo-film")}writeMessage(e){if("Enter"===e.key&&!e.shiftKey){const e=this.#N.value.trim(),t=!!this.conversationPartner.groupID,s=this.conversationPartner.partner,i={groupID:this.conversationPartner.groupID},n=new CustomEvent("writeMessage",{bubbles:!1,detail:{text:this.#N.value,nickname:this.ME.nickname,sender:this.ME.id,endless:this.ME.endless,receiver:s,threadID:this.conversationPartner.threadID,type:t?"group":"user",...t?i:{},messageType:"text",done:()=>(this.#N.disabled=!1,this.#N.value="",this.#R())}});if(0===e.length)return;return this.#N.disabled=!0,ce.app.dispatchEvent(n)}}uploadMedia(){this.querySelector('[type="file"]').click()}scrollToBottom(){requestAnimationFrame((()=>{const e=this.querySelector(".messages");e.scrollTop=e.scrollHeight}))}#z(e,t){const s=!!this.conversationPartner.groupID,i={groupID:this.conversationPartner.groupID},n=new CustomEvent("uploadMedia",{bubbles:!1,detail:{contentID:ei(),contentType:"image",content:e,imgHeight:t.height,imgWidth:t.width,isGroup:s,receiver:this.conversationPartner.partner,nickname:this.ME.nickname,sender:this.ME.id,threadID:this.conversationPartner.threadID,messageType:"image",...s?i:{},type:s?"group":"user",done:()=>{this.#G.classList.add("fa-photo-film"),this.#G.classList.remove("disabled","fa-circle-notch","fa-spin")}}});return ce.app.dispatchEvent(n)}#F(e){const t=new FileReader,s=document.createElement("img"),i=URL.createObjectURL(e);return t.onload=()=>{s.src=i,s.onload=()=>(this.#z(t.result,s),URL.revokeObjectURL(i))},t.readAsDataURL(e)}isImageRendered(e){return"true"===this.querySelector(`img[data-contentid="${e.contentID}"]`)?.getAttribute("data-rendered")}insertImage(e){const t=this.querySelector(`[data-contentid="${e.contentID}"]`),s=t?.previousSibling;if(s)return t.style="",t.parentNode.setAttribute("href",e.content),t.setAttribute("data-rendered",!0),t.setAttribute("src",e.content),t.parentNode.removeChild(s)}changeInputEvent({target:e}){const t=[...e.files][0];if(t.size>=2097152)return ce.toast.notification={type:"error",text:"Max allowed file size for images is 2mb. Please choose a smaller one."},ce.toast.open();this.#G.classList.remove("fa-photo-film"),this.#G.classList.add("fa-circle-notch","fa-spin","disabled"),this.#F(t),e.setAttribute("value",""),e.value=null}renderWriteContainer(){return $`<div class="write-container"><textarea placeholder="write a new message" @keydown="${this.writeMessage}" class="write-message-input" type="text" maxlength="1000"></textarea><div><i @click="${this.uploadMedia}" class="fa-solid fa-photo-film hover-font"></i><input class="hide" @change="${this.changeInputEvent}" type="file" accept="image/png, image/gif, image/jpeg"></div></div>`}renderConversationPartner(){const e=this.conversationPartner.endless?$`<i class="fa-solid fa-check"></i>`:"",t=$`<i class="fa-solid fa-${gi[this.conversationPartner.type]}"></i>`,s="system"!==this.conversationPartner.type?$`<span>#${this.conversationPartner.id||this.conversationPartner.groupID}</span>`:"",i=$`<p @click="${this.clickOnUser}" class="hover-font">${t} ${this.conversationPartner.nickname} ${s}</p>`,n=$`<i @click="${this.clickOnBack}" class="fa-solid fa-arrow-left ${oe?"":"shrink-to-zero"}"></i>`,o=$`<div class="conversation-partner-user">${i}${e}</div>`;return $`<div class="conversation-partner">${n}${o}</div>`}#q(e,t,s){let i=e;const n=t.flatMap((function(e){const t=`<a href="${e}" target="_blank" rel="noopener noreferrer">${e}</a>`,[s,...n]=i.split(e);return i=n.join(e),[s,ne(t)]}));return n.push(i),$`<p class="message-text">${n} ${s}</p>`}#W({text:e},t){const s=function(e){return e.match(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gi)||[]}(e);return 0===s.length?$`<p class="message-text">${e} ${t}</p>`:this.#q(e,s,t)}#Q(e,t){return"image"===e.messageType?$`<a href="" download="${e.contentID}.png"><i class="fa-solid fa-spin fa-circle-notch"></i><img download="${e.contentID}" style="height:500px" data-contentid="${e.contentID}" data-rendered="false" src=""></a><p>${t}</p>`:this.#W(e,t)}#X(e,t){if(this.#H.status=e,this.#H.groupMembers=this.#K.members,this.#H.type=t?"group":"unkown",t)return this.#H.open()}#Y(e,t,s){return e?s||1!==t.length?s&&this.#K.members.every((e=>t.includes(e.id)||e.id===this.ME.id))?$`<i @click="${()=>this.#X(t,s)}" class="fa-solid fa-check read-check hover-cursor"></i><i @click="${()=>this.#X(t,s)}" class="fa-solid fa-check read-check hover-cursor"></i>`:s?$`<i @click="${()=>this.#X(t,s)}" class="fa-solid fa-check sent-check hover-cursor"></i>`:$`<i class="fa-solid fa-check sent-check"></i>`:$`<i class="fa-solid fa-check read-check"></i><i class="fa-solid fa-check read-check"></i>`:""}#J(e){const{nickname:t,id:s,memberIcon:i,color:n,endless:o}=this.#K.members.find((t=>t.id===e.sender)),r=o?$`<i class="fa-solid fa-check danger-color"></i>`:"";return $`<p class="group-color-${n} message-top-line"><span>${i} ${t} ${r}</span><span>#${s}</span></p>`}#V({sender:e}){const t=e===this.ME.id;return $`<div class="message-container"><div class="message ${t?"sent-message":"received-message"}"><p><i class="fa-solid fa-trash-can"></i>${le.MESSAGEREMOVED}</p></div></div>`}#Z(e,t){const{messageID:s,sender:i,status:n,ts:o}=e,r=i===this.ME.id,a=t&&!r?this.#J(e):"",c=this.#Y(r,n,t),l=new Date(o).toLocaleTimeString(),d=$`<small class="message-bottom-line float-right unselectable">${l}${c}</small>`,h=this.#Q(e,d);return $`<div data-messageid="${s}" class="message-container"><div class="message ${r?"sent-message":"received-message"} message-${e.messageType}">${a}${h}</div></div>`}#ee(e){const t=new Date(e.ts).toLocaleTimeString(),s=mi[e.text].replace("{{extra1}}",e.extra1).replace("{{extra2}}",e.extra2).replace("{{extra3}}",e.extra3).replace("{{id}}",this.ME.id).replace("{{threadID}}",e.threadID).replace("{{nickname}}",this.ME.nickname).replace("{{conversationID}}",this.conversationPartner.partner),i=$`<p><small class="float-right unselectable">${t}</small></p>`;return $`<div alt="${e.nickname}" data-messageid="${e.messageID}" class="message-container system-message"><div class="message"><p>${ne(s)}</p>${i}</div></div>`}render(){const e="group"===this.conversationPartner.type,t=ui(this.messages,(e=>e.messageID),(t=>{const s="system"===t.messageType;return"removed"===t.messageType?this.#V(t):s?this.#ee(t):this.#Z(t,e)})),s=$`<div class="messages">${t}</div>`;return $`${this.renderConversationPartner()}${s}${this.renderWriteContainer()}`}});customElements.define("user-menu",class extends J{static properties={ME:{type:Object}};#te={};#se={};constructor(){super(),this.ME=de}createRenderRoot(){return this}clickOnEndlessToken(){const e=this.#se.value.trim(),t=new CustomEvent("setToken",{bubbles:!1,detail:{...this.ME,token:e,wrongToken:()=>(ce.toast.notification={type:"error",text:"Your token is invalid"},ce.toast.open()),tokenInUse:()=>(ce.toast.notification={type:"error",text:"This token is already in use"},ce.toast.open()),success:({tokenType:e,validTime:t})=>{const s="endless"===e?e:t/1e3/60/60/24+" days";ce.toast.notification={type:"success",text:`Your acc is upgraded to ${s}`},this.#se.value="",ce.toast.open()}}});return e.length<32?(ce.toast.notification={type:"error",text:"Your token is too short"},ce.toast.open()):ce.app.dispatchEvent(t)}#ie(e){const t=new CustomEvent("setUserStatus",{bubbles:!1,detail:{userStatus:e}});return ce.app.dispatchEvent(t)}keyDownStatus(e){clearTimeout(this.#te),this.#te=setTimeout((()=>{const t=e.target.value.trim();if(this.ME.userStatus===t)return clearTimeout(this.#te);this.ME={...this.ME,status:t},this.#ie(t)}),400)}firstUpdated(){this.#se=this.querySelector("input")}render(){const e=Js(this.ME.expire),t=this.ME.endless?$`<i class="fa-solid fa-check danger-color"></i>`:$`<i class="fa-solid fa-times"></i>`,s=this.ME.endless?"":$`<p>Valid until: <i>${e}</i></p>`,i=$`<div class="settings-container"><p>ID: <i>#${this.ME.id}</i></p><p>Nickname: <i>${this.ME.nickname}</i></p>${s}<p>Endless Account: ${t}</p></div>`,n=$`<div class="settings-container"><p>Status</p><textarea @keydown="${e=>this.keyDownStatus(e)}" maxlength="280">${this.ME.userStatus}</textarea></div>`,o=this.ME.endless?"":$`<div class="settings-container"><p>Token</p><input type="text" maxlength="${32}"><button class="hover-green" @click="${this.clickOnEndlessToken}">Check</button></div>`;return $`<h1>User Menu</h1>${i}${n}${o}`}});customElements.define("settings-menu",class extends J{static properties={ME:{type:Object}};#ne={};#oe=document.querySelector("codes-modal-window");constructor(){super(),this.ME=de}createRenderRoot(){return this}clickOnCodes(){return this.#oe.open()}#re(e,t){const s=new CustomEvent("changeNickName",{bubbles:!1,detail:{oldNickname:t,newNickname:e}});return ce.app.dispatchEvent(s)}changeName(e){clearTimeout(this.#ne),this.#ne=setTimeout((()=>{const t=e.target.value,s=this.ME.nickname;this.ME={...this.ME,nickname:t},this.#re(t,s)}),900)}render(){const e=ce.app.getAttribute("data-version"),t=$`<div class="settings-container"><p>Nickname is ${this.ME.nickname}</p><input @input="${this.changeName}" type="text" value="${this.ME.nickname}" maxlength="20"></div>`,s=$`<div class="settings-container"><p>Destroy and Unlock</p><button @click="${this.clickOnCodes}" class="danger-background">${this.ME.codes?"Update":"Setup"}</button></div>`,i=$`<div class="settings-container"><p>Version: ${e}</p></div>`;return $`<h1>Settings</h1>${t}${s}${i}`}});function wi({endless:e,nickname:t,partner:s,text:i,ts:n,type:o,messageType:r,status:a}){const c="system"===o,l=function(e){const t=new Date(e),s=Math.abs(new Date(e)-new Date)/36e5,i=t.toDateString(),n=t.toLocaleTimeString();return s<24?n.substring(0,5):s<168?t.toLocaleDateString("en",{weekday:"long"}):i}(n),d=$`<i class="fa-solid fa-${gi[o]} thread-avatar"></i>`,h=e||c?$`<i class="fa-solid fa-check danger-color"></i>`:"",u=c?"":$`<span class="float-right">#${s}<span></span></span>`,p=function(e,t,s){return s||"system"===t?vi[e]:e.length<=23?e:e.substring(0,23)+""}(i,r,c),g=$`<span class="thread-read-indicator${"read"===a?" shrink-to-zero":""}"></span>`;return $`<div partner="${s}" type="${o}" class="thread hover-background">${g}${d}<div><p>${t}${h}${u}</p><p>${p} <span class="float-right unselectable">${l}</span></p></div></div>`}function bi(e){return e.classList.contains("active-setting")}function ki(e){const t=e.querySelector("header i.fa-circle-user");[...e.querySelectorAll(".bottom-navi div.active-setting")].forEach((e=>e.classList.remove("active-setting"))),t.classList.remove("active-setting")}customElements.define("threads-menu",class extends J{static properties={threads:{type:Array}};#ae=!1;constructor(){super(),this.threads=[],this.addEventListener("click",(e=>this.clickOnThreads(e)))}#ce(e){if(ae){this.querySelector(".active-thread")?.classList.remove("active-thread"),e?.classList.add("active-thread")}}#le(e){const t=e.querySelector(".thread-read-indicator");t.classList.contains("shrink-to-zero")||t.classList.add("shrink-to-zero")}clickOnThreads(e){const t=e.target.expire?e.target:e.target.closest(".thread"),s=t.getAttribute("partner"),i=this.threads.find((e=>e.partner===s)),n=new CustomEvent("threadSelect",{bubbles:!1,detail:{...i}});return oe&&(ce.navi.classList.add("hide"),ce.menus.messagesMenu.classList.remove("hide"),ce.header.classList.add("hide"),ce.bottomNavi.classList.add("hide")),ae&&(ce.app.clickOnChat(e),ce.bottomNavi.querySelector("div").classList.add("active-setting")),ce.menus.messagesMenu.messages=[],ce.menus.messagesMenu.conversationPartner=i,this.#le(t),this.#ce(t),ce.menus.messagesMenu.setActive(i),ce.app.dispatchEvent(n)}createRenderRoot(){return this}bootStrap(){requestAnimationFrame((()=>{const e=this.querySelector(".thread");!this.#ae&&e&&ae&&(e.click(),this.#ae=!0)}))}render(){return ui(this.threads,(e=>e.id),wi)}});customElements.define("app-layout",class extends J{static properties={ME:{type:Object}};#de={settingsMenu:{},messagesMenu:{},userMenu:{}};#he={};#K=document.querySelector("groupuser-modal-window");#ue=document.querySelector("modal-window");#pe=document.querySelector("invite-modal-window");#ge=document.querySelector("panic-modal-window");#ye=document.querySelector("conversation-modal-window");#fe=document.querySelector("lock-modal-window");#oe=document.querySelector("codes-modal-window");#H=document.querySelector("status-modal-window");#me=0;#ve=0;#we=0;#be=0;set ME(e){Object.values(this.#de).forEach((function(t){t.ME=e})),this.#H.ME=e,this.#K.ME=e,this.#oe.ME=e,this.#fe.ME=e,this.#ge.ME=e,this.#pe.ME=e,this.#ye.ME=e,this.requestUpdate("ME",e)}constructor(){super(),this.ME=de}createRenderRoot(){return this}clickOnChat(e){bi("DIV"===e.target.tagName?e.target:e.target.parentNode)||(this.setActiveMenu("messagesMenu"),ki(this))}clickOnUser({target:e}){bi(e)||(this.setActiveMenu("userMenu"),ki(this),e.classList.add("active-setting"))}clickOnSettings(e){const t="DIV"===e.target.tagName?e.target:e.target.parentNode;bi(t)||(this.setActiveMenu("settingsMenu"),ki(this),t.classList.add("active-setting"))}setActiveMenu(e){return Object.values(this.#de).forEach((function(e){e.classList.contains("hide")||e.classList.add("hide")})),oe&&"messagesMenu"!==e&&(ce.navi.classList.add("hide"),this.querySelector("main").classList.add("settings-mobile-menu-active")),oe&&"messagesMenu"===e?(ce.navi.classList.remove("hide"),void this.querySelector("main").classList.remove("settings-mobile-menu-active")):this.#de[e]&&this.#de[e].classList.contains("hide")?this.#de[e].classList.remove("hide"):void 0}clickOnNewConv(){return this.#ye.open()}clickOnInvite(){return this.#pe.open("join")}clickOnPanic(){return this.#ge.open()}openWelcomeWindow({id:e,nickname:t}){return this.#ue.setAndOpen({HTML:`<h1>Welcome to Be8</h1><p>your new ID is <i class="highlight-color">#${e}</i>, your nickname is <i class="highlight-color">${t}</i>. Everything gets deleted after 30 Days you can create as many accs as you want.</p>`})}firstUpdated(){super.connectedCallback();const e={messagesMenu:this.querySelector("messages-menu"),settingsMenu:this.querySelector("settings-menu"),userMenu:this.querySelector("user-menu")};ce.app=this,ce.menus=e,ce.threads=this.querySelector("threads-menu"),ce.settings=this.querySelector("settings-menu"),ce.user=this.querySelector("user-menu"),ce.navi=this.querySelector("nav"),ce.header=this.querySelector("header"),ce.bottomNavi=this.querySelector(".bottom-navi"),ce.toast=document.querySelector("toast-notification"),this.#de=e,this.#he=this.querySelector("threads-menu"),requestAnimationFrame((function(){oe||e.messagesMenu.focus()}))}async openLockModal(e){return this.#fe.open(e)}setGroupMember({members:e,valid:t}){t&&(this.#K.members=e.map((function(e,t){const s=Math.abs(Math.floor(t/16)),i=t+1;return e.memberIcon=fi[i],e.color=i-16*s+1,e})))}getConversationPartner(){return this.#de.messagesMenu.conversationPartner}isImageRendered(e){return this.#de.messagesMenu.isImageRendered(e)}insertImage(e){return this.#de.messagesMenu.insertImage(e)}setMessages(e){this.#de.messagesMenu.messages=e.filter((e=>e.valid)),this.#de.messagesMenu.scrollToBottom()}setThreads(e){this.#he.threads=e,this.#he.bootStrap()}clickOnThread({partner:e}){this.#he.querySelector(`[partner="${e}"]`)?.click()}getConversationPartners(){return this.#he.threads.map((e=>e.partner)).filter((e=>"s1"!==e))}#ke(){this.#ve,this.#me,this.#be,this.#we,this.#be,this.#we,this.#be,this.#we,this.#ve>this.#me&&ce.menus.messagesMenu.clickOnBack()}#Ee(e){this.#me=e.changedTouches[0].screenX,this.#we=e.changedTouches[0].screenY}#Ae(e){return this.#ve=e.changedTouches[0].screenX,this.#be=e.changedTouches[0].screenY,this.#ke()}render(){const e=$`<header><i @click="${e=>this.clickOnUser(e)}" class="fa-solid fa-circle-user hover-font"></i><i @click="${e=>this.clickOnNewConv(e)}" class="fa-solid fa-pen-clip float-right hover-font"></i></header>`,t=$`<div class="bottom-navi"><div @click="${e=>this.clickOnChat(e)}" class="active-setting hover-font"><i class="fa-solid fa-comments"></i><small>${le.THREADSTITLE}</small></div><div @click="${e=>this.clickOnSettings(e)}" class="hover-font"><i class="fa-solid fa-gears"></i><small>Settings</small></div><div @click="${e=>this.clickOnInvite(e)}" class="hover-font"><i class="fa-solid fa-plus"></i><small>Invite</small></div><div @click="${e=>this.clickOnPanic(e)}" class="hover-font"><i class="fa-solid fa-bomb"></i><small>Panic</small></div></div>`,s=$`<messages-menu class="${oe?"hide":""}"></messages-menu><settings-menu class="hide"></settings-menu><user-menu class="hide"></user-menu>`;return $`${e}<nav><h1 class="chats-headline unselectable">Chats</h1><threads-menu></threads-menu></nav>${t}<main>${s}</main>`}});const Ei={method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"}},Ai={method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"}};async function Si(e){return await fetch("/subscribe",{...Ei,body:JSON.stringify(e)})}async function Ci(){return await navigator.serviceWorker.register("/serviceworker.js"),"PushManager"in window?navigator.serviceWorker.ready.then((function(e){return e.pushManager.getSubscription().then((function(t){return null===t?async function(e){const t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:"BGcpbQEQRF2Ans4lXwnyqd9EnWT2MgNx9j-ns5EoXDtmQZonB1TqGpBuJlw32gqvbHGTZQgh79mYYjp6dX-8zOg"});await Si(t)}(e):Si(t)})).catch((function(e){"denied"===Notification.permission?console.log("Permission for Notifications was denied"):console.log("Unable to subscribe to push.",e)}))})):console.log("Browser does not have push notifications functionality")}async function Di(){return await async function(){const e=indexedDB.open("be8",1);return new Promise((function(t,s){e.onupgradeneeded=function(){const t=e.result,s=t.createObjectStore("publicKeys",{keyPath:"accID"}),i=t.createObjectStore("privateKeys",{keyPath:"accID"}),n=t.createObjectStore("groupKeys",{keyPath:["groupID","version"]});[["crv","crv",{unique:!1}],["x","x",{unique:!1}],["y","y",{unique:!1}],["kty","kty",{unique:!1}],["key_ops","key_ops",{unique:!1}],["ext","ext",{unique:!1}]].forEach((function(e){s.createIndex(...e),i.createIndex(...e),n.createIndex(...e)})),console.log("upgrade or insert db")},e.onsuccess=function(){return t(e)},e.onerror=function(e){return console.log("IndexedDB error"),console.log(e),s()}}))}()}function Ii(){const e=self.crypto.randomUUID();return(new TextEncoder).encode(e)}function _i(e){const t=new Uint8Array(e);let s="";for(let e=0;e<t.byteLength;e++)s+=String.fromCharCode(t[e]);return window.btoa(s)}function Mi(e){if(!e)throw"engine: id is required in getTypeOfKey";return"g"===e.charAt(0)?"group":"c"===e.charAt(0)?"channel":"dialog"}const xi=Object.freeze(["deriveKey","deriveBits"]),$i=Object.freeze({name:"ECDH",namedCurve:"P-384"});class Bi{#Se={};#Ce="";#De=new Map;#Ie=new Map;#_e=new Map;#Me=new Map;constructor(e,t){if(this.#Ce=e,this.#Se=t,"string"!=typeof e||isNaN(e))throw`engine: no acc id or wrong type passed to the constructor got ${e}`;if(!t)throw"engine: no indexedDB passed to the constructor"}async setup(){const e=await this.getCachedKeys(),t=await this.getCachedGroupKeys(),s=this.#Se.result.transaction("privateKeys","readwrite").objectStore("privateKeys").getAll(),i=this.#Ce,n=await new Promise((function(e){s.onsuccess=function(t){return e(t.target.result.find((e=>e.accID===i)))}}));return n?(console.log(`engine: old acc, used id: #${this.#Ce}`),this.#Ie.set(this.#Ce,n)):(console.log(`engine: brand new acc, set id: #${this.#Ce}`),await this.generatePrivAndPubKey()),e.forEach((({accID:e,publicKey:t})=>this.#De.set(e,t))),t.forEach((({groupID:e,version:t,groupKey:s})=>this.#_e.set(`${e}:${t}`,s))),e}getAccID(){return this.#Ce}hasGeneratedKeys(){const e=this.#De.has(this.#Ce),t=this.#Ie.has(this.#Ce);return e||console.log(`engine: No public key for ${this.#Ce} in hasKeys`),t||console.log(`engine: No private key for ${this.#Ce} in hasKeys`),e&&t}hasKey(e){const t=Mi(e);return"group"===t?this.#_e.has(e):"channel"===t?this.#Me.has(e):this.#Ie.has(e)}#xe(e){const t=Mi(e);return"group"===t?this.#_e.get(e):"channel"===t?this.#Me.get(e):this.#De.get(e)}#$e(e){const t=Mi(e);return"group"===t?this.#_e.get(e):"channel"===t?this.#Me.get(e):this.#Ie.get(e)}async addPublicKeys(e=[]){const t=this.#Se.result.transaction("publicKeys","readwrite").objectStore("publicKeys");e.forEach((({accID:e,publicKey:t})=>this.#De.set(e,t)));const s=e.map((function({accID:e,publicKey:s}){t.put({accID:e,...s}),t.onsuccess=()=>console.log(`engine: added public key for ${e}`)}));return await Promise.all(s)}addPublicKey(e,t){const s=this.#Se.result.transaction("publicKeys","readwrite").objectStore("publicKeys");return e||console.log(`engine: missing accID: "${e}" at addPublicKey`),t||console.log(`engine: missing key: "${t}" at addPublicKey`),s.put({accID:e,...t}),this.#De.set(e,t)}async addGroupKeys(e,t){if(e&&t?.length>0){const s=this.#Se.result.transaction("groupKeys","readwrite").objectStore("groupKeys");t.forEach((({version:t,groupKey:s})=>this.#_e.set(`${e}:${t}`,s)));const i=t.map((function({version:t,groupKey:i}){s.put({groupID:e,version:t,...i}),s.onsuccess=()=>console.log(`engine: added group key for ${e}`)}));return await Promise.all(i)}console.log(`engine: missing groupID: "${e}" or keys: "${t}" in addGroupKey`)}async getMyPublicKey(){const e=this.#Se.result.transaction("publicKeys","readwrite").objectStore("publicKeys").get(this.#Ce);return await new Promise((function(t){e.onsuccess=function(e){return t(e.target.result)}}))}async getCachedKeys(){const e=this.#Se.result.transaction("publicKeys","readwrite").objectStore("publicKeys").getAll();return await new Promise((function(t){e.onsuccess=function(e){const s=e.target.result.map((e=>({accID:e.accID,publicKey:e})));return t(s)}}))}async getCachedGroupKeys(){const e=this.#Se.result.transaction("groupKeys","readwrite").objectStore("groupKeys").getAll();return await new Promise((function(t){e.onsuccess=function(e){const s=e.target.result.map((e=>({groupID:e.groupID,version:e.version,groupKey:e})));return t(s)}}))}async getCachedGroupVersions(e){const t=this.#Se.result.transaction("groupKeys","readwrite").objectStore("groupKeys").getAll();return await new Promise((function(s){t.onsuccess=function(t){const i=t.target.result.filter((t=>t.groupID===e)).map((e=>e.version)).sort((function(e,t){return parseInt(e)<parseInt(t)?1:-1}));return s(i)}}))}async generateGroupKeys(e,t){const{privateKey:s,publicKey:i}=await window.crypto.subtle.generateKey($i,!0,xi),n=[window.crypto.subtle.exportKey("jwk",i),window.crypto.subtle.exportKey("jwk",s)],o=await Promise.all(n),r=this.#_e.get(`${t}:${e}`);return r?(console.log(`engine: Group keys for ${e} already exist`),r):(this.#_e.set(`${t}:${e}`,o[1]),o)}async generatePrivAndPubKey(){const{privateKey:e,publicKey:t}=await window.crypto.subtle.generateKey($i,!0,xi),s=[window.crypto.subtle.exportKey("jwk",t),window.crypto.subtle.exportKey("jwk",e)],i=await Promise.all(s),n=this.#Se.result.transaction("privateKeys","readwrite"),o=this.#Se.result.transaction("publicKeys","readwrite"),r=o.objectStore("publicKeys"),a=n.objectStore("privateKeys");return r.put({accID:this.#Ce,...i[0]}),a.put({accID:this.#Ce,...i[1]}),this.#De.set(this.#Ce,i[0]),this.#Ie.set(this.#Ce,i[1]),await n.complete,await o.complete,i}async getDerivedKey(e,t){if(!e)throw"engine: no public key passed to getDerivedKey";if(!t)throw"engine: no private key passed to getDerivedKey";const s=window.crypto.subtle.importKey("jwk",e,$i,!0,[]),i=window.crypto.subtle.importKey("jwk",t,$i,!0,xi);return Promise.all([s,i]).then((function([e,t]){return window.crypto.subtle.deriveKey({name:"ECDH",public:e},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}))}async encryptText(e,t=""){const s=(new TextEncoder).encode(t),i=Ii(),n=(new TextDecoder).decode(i),o={name:"AES-GCM",iv:i};if(!e)throw"engine: no derived key passed to encryptText";return window.crypto.subtle.encrypt(o,e,s).then((function(e){const t=new Uint8Array(e),s=String.fromCharCode.apply(null,t);return{cipherText:window.btoa(s),iv:n}}))}async decryptText(e,t="",s){const i=window.atob(t),n=new Uint8Array([...i].map((e=>e.charCodeAt(0)))),o={name:"AES-GCM",iv:new TextEncoder("utf-8").encode(s)};if(!e)throw"engine: no derived key passed to decryptText";if(!s)throw"engine: no iv (Initialization vector) passed to decryptText";return window.crypto.subtle.decrypt(o,e,n).then((function(e){return(new TextDecoder).decode(e)}))}async encryptTextSimple(e,t,s){const i=this.#xe(t),n=this.#$e(e);if(!i)throw`engine: Missing public key for ${t} at encryptTextSimple`;if(!n)throw`engine: Missing private key for ${e} at encryptTextSimple`;const o=await this.getDerivedKey(i,n);return await this.encryptText(o,s)}async decryptTextSimple(e,t,s,i){const n=this.#xe(e),o=this.#$e(t);if(!n)throw`engine: Missing public key for ${e} at decryptTextSimple`;if(!o)throw`engine: Missing private key for ${t} at decryptTextSimple`;const r=await this.getDerivedKey(n,o);return await this.decryptText(r,s,i)}async encryptImage(e,t){const s=(new TextEncoder).encode(t),i=Ii(),n=(new TextDecoder).decode(i);if(!e)throw"engine: no derived key passed to decryptText";return window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},e,s).then((function(e){return{cipherImage:_i(e),iv:n}}))}async decryptImage(e,t,s){const i=window.atob(t),n=new Uint8Array([...i].map((e=>e.charCodeAt(0)))),o={name:"AES-GCM",iv:new TextEncoder("utf-8").encode(s)};if(!e)throw"engine: no derived key passed to decryptText";return window.crypto.subtle.decrypt(o,e,n).then((function(e){return(new TextDecoder).decode(e)}))}async encryptImageSimple(e,t,s){const i=this.#xe(t),n=this.#$e(e);if(!i)throw`engine: Missing public key for ${e} at encryptImageSimple`;if(!n)throw`engine: Missing private key for ${t} at encryptImageSimple`;const o=await this.getDerivedKey(i,n);return await this.encryptImage(o,s)}async decryptImageSimple(e,t,s,i){const n=this.#xe(e),o=this.#$e(t);if(!n)throw`engine: Missing public key for ${e} at decryptImageSimple`;if(!o)throw`engine: Missing private key for ${t} at decryptImageSimple`;const r=await this.getDerivedKey(n,o);return await this.decryptImage(r,s,i)}async panic(){const e=this.#Se.result.transaction("publicKeys","readwrite"),t=this.#Se.result.transaction("privateKeys","readwrite"),s=this.#Se.result.transaction("groupKeys","readwrite"),i=e.objectStore("publicKeys"),n=t.objectStore("privateKeys"),o=s.objectStore("groupKeys"),r=new Promise((function(e){i.clear().onsuccess=function(){return e()}})),a=new Promise((function(e){n.clear().onsuccess=function(){return e()}})),c=new Promise((function(e){o.clear().onsuccess=function(){return e()}}));await Promise.all([r,a,c]),this.#De.clear(),this.#Ie.clear(),this.#_e.clear(),this.#Me.clear()}}let Oi=null;var Ti=Object.freeze({messageReceived(){clearTimeout(Oi),Oi=setTimeout((()=>{const e=new Audio("assets/sounds/received.mp3").play();e&&e.catch(console.log)}),300)}});const Pi=document.querySelector("app-layout"),Ui=e=>Pi.ME=e,Li=Object.freeze({newMessage:async function(e){e.threadID===Pi.getConversationPartner().threadID&&await Xi({detail:e});document.hidden&&Ti.messageReceived();return await Qi()},messageRead:async function(e){e.threadID===Pi.getConversationPartner().threadID&&await Xi({detail:e})},expiredAcc:async function(e){e.threadID===Pi.getConversationPartner().threadID&&Pi.clickOnThread({partner:"s1"});return await Qi()},newConversation:Ni,groupMemberRemove:async function(e){const t=e.groupID===Pi.getConversationPartner().threadID,s=e.leavingMember===Ki.getAccID();t&&!s&&await Xi({detail:e});t&&s&&Pi.clickOnThread({partner:"s1"});await Qi()},groupJoin:async function(e){e.groupID===Pi.getConversationPartner().threadID&&await Xi({detail:e});await Qi()},groupCreate:Ni});let Ki={},ji=0;function Hi(){const e=new EventSource("/events");ji++,e.addEventListener("open",(function(){ji=0})),e.addEventListener("message",(async function(e){const t=JSON.parse(e.data);return await Li[t.action](t)}),!1),e.addEventListener("error",(async function(t){const s=(new Date).toISOString();return e.close(),ji>99?(document.querySelector("modal-window").setAndOpen({HTML:"Can not connect to server please refresh"}),console.log(`${s} Tried 100 reconnections, no success please refresh`)):(console.log(`${s} Reconnect SSE because of:`),console.log(t),setTimeout((()=>Hi()),2500))}),!1)}async function Ni(e){await Qi(),Pi.clickOnThread(e)}async function Gi({id:e},t){return Ki=new Bi(e,t),Object.freeze(Ki),await Ki.setup()}async function Ri({detail:e}){const t=await fetch("/startConversation",{...Ei,body:JSON.stringify(e)}),s=await t.json();return s.valid?e.success():"ACCNOTEXISTS"===s.error?e.idDoesNotExist():void 0}async function zi(e){const t=e.filter((function(e){if("image"===e.messageType)return!Pi.isImageRendered(e)})),s=await t.map((async function(e){const t=await fetch("/imageget",{...Ei,body:JSON.stringify({contentID:e.contentID,threadID:e.threadID,sender:e.sender,messageID:e.messageID})});return await t.json()})),i=await Promise.all(s),n=i.filter((e=>e.valid)),o=i.filter((e=>!e.valid)),r=Ki.getAccID();o.forEach((e=>Pi.insertImage({...e,content:"data:image/png;base64,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"}))),n.forEach((e=>{const t=e.sender===r?e.receiver:e.sender,s=e.groupVersionKey?e.sender:t,i=e.groupVersionKey||r;if(Ki.hasKey(i))return Ki.decryptImageSimple(s,i,e.content,e.iv).then((function(t){return Pi.insertImage({...e,content:t})}))}))}async function Fi(e){const t=Ki.getAccID(),s=e.map((async function(e){const s=e.sender===t?e.receiver:e.sender,i=e.groupVersionKey?e.sender:s,n=e.groupVersionKey||t,o=Ki.hasKey(n);if("system"===e.messageType)return e;if(!o)return e.valid=!1,e;if("text"===e.messageType){const t=await Ki.decryptTextSimple(i,n,e.text,e.iv);e.text=t}return e}));return await Promise.all(s)}async function qi(e){const t=await Ki.getCachedGroupVersions(e),s=t[0],i=await Yi(e);if(!s||parseInt(i)>parseInt(s))return await async function(e,t){const s=Ki.getAccID(),i=await fetch("/groupGetkeys",{...Ei,body:JSON.stringify({groupID:e,accID:s})}),{groupKeys:n}=await i.json(),o=n.filter((e=>!t.includes(e.groupVersion))),r=o.map((e=>e.keyholder));if(await Wi(r),o.length>0){const t=o.map((async function({groupKey:e,keyholder:t,iv:i}){return await Ki.decryptTextSimple(t,s,e,i)})),i=(await Promise.all(t)).map((function(e,t){return{groupKey:JSON.parse(e),version:o[t].groupVersion}}));return await Ki.addGroupKeys(e,i)}}(e,t)}async function Wi(e=[]){const t=await async function(){return(await Ki.getCachedKeys()).map((e=>e.accID))}(),s=Pi.getConversationPartners().concat(e).filter((e=>!e.includes("g")&&!t.find((t=>t===e))));if(0===s.length)return;const i=await fetch("/getkeys",{...Ei,body:JSON.stringify({accIDs:s})}),n=await i.json();return n.valid?await Ki.addPublicKeys(n.publicKeys):void 0}async function Qi(){const e=await fetch("/getthreads",Ai),{valid:t,threads:s}=await e.json(),i=s.filter((e=>e.groupID)).map((e=>e.groupID)),n=s.filter((e=>!e.groupID&&"s1"!==e.partner)).map((e=>e.partner)),o=i.map((async function(e){const t=await fetch("/groupgetmembers",{...Ei,body:JSON.stringify({groupID:e})});return await t.json()})),r=(await Promise.all(o)).flatMap((e=>e.members.map((e=>e.id)))),a=[...new Set(n.concat(r))];if(await async function(e){const t=e.map((e=>qi(e)));return await Promise.all(t)}(i),await Wi(a),!t)return;const c=await Fi(s);return Pi.setThreads(c)}async function Xi({detail:e}){return"group"===e.type?async function(e){const t=await fetch("/groupgetmembers",{...Ei,body:JSON.stringify(e)}),s=await fetch("/getmessages",{...Ei,body:JSON.stringify(e)}),{valid:i,messages:n}=await s.json(),o=await t.json(),r=o.members.map((({id:e})=>e));if(i){await qi(e.groupID),await Wi(r);const t=await Fi(n);return await Pi.setGroupMember(o),await Pi.setMessages(t),await zi(t)}}(e):"user"===e.type||"system"===e.type?async function(e){const t=await fetch("/getmessages",{...Ei,body:JSON.stringify(e)}),{valid:s,messages:i}=await t.json();if(s){const e=await Fi(i);return await Pi.setMessages(e),await zi(e)}}(e):void 0}async function Yi(e){const t=await fetch("/groupgetcurrentversion",{...Ei,body:JSON.stringify({groupID:e})}),{groupVersion:s}=await t.json();return s}async function Ji(e){const t=await fetch("/groupgetmembers",{...Ei,body:JSON.stringify({groupID:e})}),{members:s}=await t.json();return s}async function Vi(e,t,s){const i=JSON.stringify(t),n=s||await Ji(e),o=n.map((e=>e.id));await Wi(o);const r=n.map((async function({id:t}){const s=Ki.getAccID(),{cipherText:n,iv:o}=await Ki.encryptTextSimple(s,t,i);return await fetch("/groupstorekey",{...Ei,body:JSON.stringify({keyholder:s,groupID:e,groupKey:n,accID:t,iv:o})})}));return await Promise.all(r)}async function Zi(e){const t=await async function(e){const t=await fetch("/groupincreaseversion",{...Ei,body:JSON.stringify({groupID:e})}),{groupVersion:s}=await t.json();return s}(e),[,s]=await Ki.generateGroupKeys(t,e);return s}async function en(){const e=new URL(window.location.href),t=e.searchParams.get("user"),s=e.searchParams.get("group");return window.history.replaceState({},document.title,"/"),t?await async function(e){await Ri({detail:{id:Ki.getAccID(),receiverID:e,success:()=>{}}}),await fetch("/invitelink",{...Ei,body:JSON.stringify({type:"user",usedInviteLink:!0})})}(ii(t)):s?await async function(e){const{valid:t}=await tn(e);if(t){const t=await Zi(e);await Vi(e,t),await qi(e),await fetch("/invitelink",{...Ei,body:JSON.stringify({type:"group",usedInviteLink:!0})})}}(ii(s)):void 0}async function tn(e){const t=await fetch("/groupjoinmember",{...Ei,body:JSON.stringify({groupID:e})});return await t.json()}async function sn(e){const t=await fetch("/newacc",{...Ei,body:JSON.stringify({...ti(),nickname:`${Ws[Math.floor(Math.random()*Ws.length)]} ${Qs[Math.floor(Math.random()*Qs.length)]}`})});if((await t.json()).valid){const t=await fetch("/me",Ai),{accObj:s}=await t.json();return Ui(s),await Gi(s,e),await async function(){const e=await Ki.getMyPublicKey();await fetch("/setkey",{...Ei,body:JSON.stringify({publicKey:e})})}(),await en(),await Qi(),Pi.openWelcomeWindow(s)}}Pi.addEventListener("unlock",(async function({detail:e}){const t=await fetch("/codeunlock",{...Ei,body:JSON.stringify(e)}),{valid:s,isValid:i,isDestroyCode:n}=await t.json();return n&&location.reload(),s&&i?e.done():e.error()})),Pi.addEventListener("leaveGroup",(async function({detail:e}){await async function(e){const t=await Zi(e),s=(await Ji(e)).filter((({id:e})=>e!==Ki.getAccID()));return await Vi(e,t,s),await qi(e)}(e.groupID);const t=await fetch("/groupleavemember",{...Ei,body:JSON.stringify(e)}),{valid:s}=await t.json(e);if(s)return e.done()})),Pi.addEventListener("panic",(async function({detail:e}){await Ki.panic();const t=await fetch("/destroyacc",Ai),{valid:s}=await t.json();if(s)return await e.done()})),Pi.addEventListener("inviteGenerated",(async function({detail:e}){await fetch("/invitelink",{...Ei,body:JSON.stringify(e)})})),Pi.addEventListener("changeNickName",(async function({detail:e}){const t=await fetch("/changenickname",{...Ei,body:JSON.stringify(e)});if((await t.json()).valid){const e=await fetch("/me",Ai),{accObj:t}=await e.json();return Ui(t)}})),Pi.addEventListener("setupCodes",(async function({detail:e}){const t=await fetch("/codeset",{...Ei,body:JSON.stringify(e)});if((await t.json()).valid)return e.done()})),Pi.addEventListener("updateCode",(async function({detail:e}){const t=await fetch("/codeupdate",{...Ei,body:JSON.stringify(e)}),{valid:s,reason:i}=await t.json();return"OLDCODEWRONG"===i?e.oldCodeWrong():s?e.done():void 0})),Pi.addEventListener("setUserStatus",(async function({detail:e}){await fetch("/userstatusset",{...Ei,body:JSON.stringify(e)})})),Pi.addEventListener("setToken",(async function({detail:e}){const t=await fetch("/endlessvalidate",{...Ei,body:JSON.stringify({token:e.token})}),s=await t.json();if(s.valid&&s.validate){const t=await fetch("/me",Ai),{accObj:i}=await t.json();return Ui(i),e.success(s)}return"TOKENNOTEXIST"===s.error?e.wrongToken():!s.valid&&s.tokenInUse?e.tokenInUse():void 0})),Pi.addEventListener("startConversation",Ri),Pi.addEventListener("createGroup",(async function({detail:e}){const t=await fetch("/groupcreate",{...Ei,body:JSON.stringify({nickname:e.nickname,groupType:e.groupType})}),{valid:s,groupID:i}=await t.json();if(s){const{valid:t}=await tn(i),s=await Zi(i);if(await Vi(i,s),await qi(i),t)return e.success()}})),Pi.addEventListener("kickMemberFromGroup",(async function({detail:e}){const t=await fetch("/groupkickmember",{...Ei,body:JSON.stringify(e)}),{valid:s}=await t.json();if(s){const t=await Zi(e.groupID);return await Vi(e.groupID,t),await qi(e.groupID),e.done()}})),Pi.addEventListener("addGroupMember",(async function({detail:e}){const t=await fetch("/groupaddmember",{...Ei,body:JSON.stringify({memberID:e.id,groupID:e.groupID})}),s=await t.json();if(s.valid){const t=await Zi(e.groupID);return await Vi(e.groupID,t),await qi(e.groupID),e.done()}return e.warning(s.reason)})),Pi.addEventListener("threadSelect",Xi),Pi.addEventListener("writeMessage",(async function({detail:e}){const t=!!e.groupID&&await Yi(e.receiver),s=e.groupID?`${e.receiver}:${t}`:Ki.getAccID(),i=e.groupID?Ki.getAccID():e.receiver,{cipherText:n,iv:o}=await Ki.encryptTextSimple(s,i,e.text),r={...e,...e.groupID?{groupVersionKey:`${e.groupID}:${t}`}:{},text:n,iv:o};return await fetch("/writemessage",{...Ei,body:JSON.stringify(r)}),e.done()})),Pi.addEventListener("uploadMedia",(async function({detail:e}){const t=!!e.isGroup&&await Yi(e.receiver),s=e.isGroup?`${e.receiver}:${t}`:Ki.getAccID(),i=e.isGroup?Ki.getAccID():e.receiver,{cipherImage:n,iv:o}=await Ki.encryptImageSimple(s,i,e.content),r={...e,...e.isGroup?{groupVersionKey:`${e.receiver}:${t}`}:{},content:n,iv:o},a=await fetch("/imageupload",{...Ei,body:JSON.stringify(r)}),{valid:c}=await a.json();if(c)return e.done()})),document.addEventListener("DOMContentLoaded",(async function(){const e=await Di(),t=await fetch("/me",Ai),{error:s,accObj:i}=await t.json();return"NOTAUTH"===s?await sn(e):await async function(e,t){return Ui(e),await Gi(e,t),await Pi.openLockModal((async()=>{await en(),await Qi()}))}(i,e),ni(),Hi(),"serviceWorker"in navigator?Ci():console.log("Browser does not have serviceWorker functionality")}));
